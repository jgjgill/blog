---
title: 'Gatsby - TOC ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸° (Gastby í”„ë ˆì„ì›Œí¬ì— ê¸°ì—¬í•œ ê²½í—˜)'
description: 'Gatsbyì—ì„œ TOC ê¸°ëŠ¥ì„ êµ¬í˜„í•œ ê³¼ì •ì„ ì •ë¦¬í•©ë‹ˆë‹¤.'
date: '2023-04-03'
slug: 'adding-toc-to-gatsby'
thumbnail: './images/gatsby-thumbnail.png'
thumbnail_alt: 'gatsby-thumbnail'
category: 'development'
---

# Gatsby Blog ì œì‘ê¸°

<Callout>
  ğŸ’¡ Gatsbyì—ì„œ TOC ê¸°ëŠ¥ êµ¬í˜„ê³¼ ë¦¬íŒ©í† ë§ ê³¼ì •ì„ ë‚¨ê¸°ê³ ì í•©ë‹ˆë‹¤. í”¼ë“œë°±ì€ ì–¸ì œë‚˜
  í™˜ì˜ì…ë‹ˆë‹¤:)
</Callout>

## TOC ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°

ê¸´ ê¸€ì„ ì½ë‹¤ë³´ë©´ ìì‹ ì´ ê¸€ì˜ ì–´ëŠ ë¶€ë¶„ì„ ì½ê³  ìˆëŠ”ì§€ ì•Œê³  ì‹¶ì„ ë•Œê°€ ìˆìŠµë‹ˆë‹¤.
ë˜í•œ, í´ë¦­í•œ ëª©ì°¨ì— ë”°ë¼ í™”ë©´ì„ ì´ë™ì‹œí‚¤ê±°ë‚˜ í˜„ì¬ ë³´ê³  ìˆëŠ” í™”ë©´ì˜ ëª©ì°¨ê°€ ìŠ¤íƒ€ì¼ì´ ì ìš©ë˜ë©´ ì‚¬ìš©ìì—ê²Œ ë” ì¢‹ì€ ê²½í—˜ì„ ì œê³µí•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ë¥¼ ìœ„í•´ ì €ì˜ ë¸”ë¡œê·¸ì—ë„ TOC (Table of Contents) ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³ ì í–ˆìŠµë‹ˆë‹¤.

### gatsby-remark-autolink-headers ì„¤ì •í•˜ê¸°

[í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸](https://www.gatsbyjs.com/plugins/gatsby-remark-autolink-headers/?=mdx)ì„ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.

```bash
yarn add gatsby-remark-autolink-headers
```

gatsby.config.tsì— í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

**gatsby.config.ts**

```js
{
  resolve: 'gatsby-plugin-mdx',
  options: {
    gatsbyRemarkPlugins: [
      {
        resolve: 'gatsby-remark-autolink-headers',
      },
      // gatsby-remark-autolink-headers: gatsby-remark-prismjs ì•ì— ìœ„ì¹˜
      // https://github.com/gatsbyjs/gatsby/issues/5764
      {
        resolve: 'gatsby-remark-prismjs',
      },
    ],
  },
},
```

ì €ëŠ” `gatsby-plugin-mdx`ì™€ ê°™ì´ ì‚¬ìš©í•˜ê³  ìˆì–´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
ê´€ë ¨ëœ [ì„¤ëª…](https://www.gatsbyjs.com/plugins/gatsby-plugin-mdx/?=gatsby-plugin-mdx#gatsby-remark--plugins)ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.

ë˜í•œ, `gatsby-remark-autolink-headers` ë¬¸ì„œì—ì„œëŠ” `gatsby-remark-prismjs`ì„ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©´ í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€í•œ ìˆœì„œì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤.
ê´€ë ¨ [ì´ìŠˆ](https://github.com/gatsbyjs/gatsby/issues/5764) í™•ì¸í•´ë³´ì‹œê³  `gatsby-remark-autolink-headers`ì„ `gatsby-remark-prismjs` **ì•ì— ìœ„ì¹˜**ì‹œí‚µë‹ˆë‹¤.

ì„¤ì •ì´ ëë‚˜ë©´ GraphQLì—ì„œ **tableOfContents**ì—ì„œ ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/adding-toc-to-gatsby/images/graphql-tableofcontents.png"
  alt="graphql-tableofcontents"
/>

ë°ì´í„°ë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´ `items` ë‚´ë¶€ì— `url`ê³¼ `title`, ì¬ê·€ì ìœ¼ë¡œ `items`ê³¼ í˜¸ì¶œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì— ë§ì¶”ì–´ ê´€ë ¨ëœ íƒ€ì… ì‘ì—…ì„ ì§„í–‰í•©ë‹ˆë‹¤.

**Toc.tsx**

```js
export interface TableItem {
  url: string
  title: string
  items?: TableItem[]
}
```

```js
interface Props {
  toc: {
    items?: TableItem[],
  };
}

const Toc = ({ toc }: Props) => {
  return (
    <Aside>
      <TocElement toc={toc} />
    </Aside>
  )
}
```

```js
const TocElement = ({ toc }: Props) => {
  return (
    <TocList>
      {toc.items &&
        toc.items.map((item) => (
          <TocItem key={item.title}>{item.items && <TocElement toc={item} />}</TocItem>
        ))}
    </TocList>
  )
}
```

### ìŠ¤í¬ë¡¤ì— ë”°ë¥¸ TOC ìŠ¤íƒ€ì¼ ì ìš©í•˜ê¸°

í˜„ì¬ ì‚¬ìš©ìê°€ ë³´ê³  ìˆëŠ” ìœ„ì¹˜ì— ë”°ë¼ TOCì— ìŠ¤íƒ€ì¼ì„ ì£¼ë©´ ë” ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
ì´ë¥¼ ìœ„í•´ **IntersectionObserver**ë¥¼ í™œìš©í•˜ê³ ì í•©ë‹ˆë‹¤.
Heading íƒœê·¸ê°€ TOCë¥¼ ë‚˜ëˆ„ëŠ” ê¸°ì¤€ì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ íƒœê·¸ë“¤ì„ ê°ì§€í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´ `TocElement` ì»´í¬ë„ŒíŠ¸ì— ê´€ë ¨ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
ì¶”ê°€ëœ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```js
const Toc = ({ toc }: Props) => {
  return (
    <Aside>
      <TocElement toc={toc} />
    </Aside>
  )
}

const TocElement = ({ toc }: Props) => {
  const [scrollTocId, setScrollTocId] = useState('')

  const contentRef = useRef<{ [index: string]: IntersectionObserverEntry }>({})

  const callback = useCallback(
    (entries: IntersectionObserverEntry[], observer: IntersectionObserver) => {
      entries.forEach((entry) => {
        contentRef.current[entry.target.id] = entry
      })

      const visibleContent = Object.values(contentRef.current).filter(
        (content) => content.isIntersecting,
      )
      if (visibleContent[0]?.target.id !== undefined) {
        setScrollTocId(visibleContent[0].target.id)
      }
    },
    [],
  )

  useEffect(() => {
    const obeserver = new IntersectionObserver(callback)
    const contents = document.querySelectorAll('h1, h2, h3')

    contents.forEach((content) => obeserver.observe(content))

    return () => obeserver.disconnect()
  }, [callback])

  return (
    <TocList>
      {toc.items &&
        toc.items.map((item) => (
          <TocItem key={item.title}>
            <StyledLink
              to={item.url}
              className={scrollTocId === item.url.slice(1) ? 'active' : ''}
            >
              {item.title}
            </StyledLink>
            {item.items && <TocElement toc={item} />}
          </TocItem>
        ))}
    </TocList>
  )
}

export default Toc
```

## ë§ˆë¬´ë¦¬

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/adding-toc-to-gatsby/images/toc.gif"
  alt="toc"
/>

### Gastby í”„ë ˆì„ì›Œí¬ì— ê¸°ì—¬í•˜ê¸°

TOC ì‘ì—…ì„ í•˜ëŠ” ê³¼ì •ì—ì„œ ê³µì‹ ë¬¸ì„œë¥¼ ì½ë‹¤ê°€ `gatsby-remark-autolink-headers`ì—ì„œ ì˜¤íƒ€ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.ğŸ§

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/adding-toc-to-gatsby/images/redudant-typo.png"
  alt="redudant-typo"
/>

`redundant`ê°€ `redudant`ë¡œ ì˜¤íƒ€ê°€ ìˆë„¤ìš”.
Gatsbyë¼ëŠ” ê±°ëŒ€í•œ í”„ë ˆì„ì›Œí¬ì— ê¸°ì—¬í•  ìˆ˜ ìˆëŠ” ì¢‹ì€ ê¸°íšŒë¼ê³  ìƒê°í•˜ì—¬ ë¹ ë¥´ê²Œ ìˆ˜ì •í•˜ê³  PRì„ ë‚¨ê²¨ë´¤ìŠµë‹ˆë‹¤.

ë‹¨ìˆœíˆ ì˜¤íƒ€ë¥¼ ìˆ˜ì •í•˜ëŠ” ì‘ì—…ìœ¼ë¡œ ì½”ë“œ í•œ ì¤„ë§Œ ë°”ê¾¸ëŠ” ê²ƒì´ì§€ë§Œ, í˜¹ì‹œë‚˜ í•˜ëŠ” ë§ˆìŒì— ê³„ì† í™•ì¸í•˜ë©° ê¸°ë‹¤ë ¸ë„¤ìš”.ğŸ˜‚

**PR Merge**

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/adding-toc-to-gatsby/images/pr-merge.png"
  alt="pr-merge"
/>

ë‹¤í–‰íˆë„ [ë¨¸ì§€](https://github.com/gatsbyjs/gatsby/pull/37812)ë˜ì—ˆìŠµë‹ˆë‹¤.ğŸ‘
(ëŒ€ë‹¨í•œ ê°œë°œìë¶„ì˜ Thanksê¹Œì§€... ì˜ê´‘ì…ë‹ˆë‹¤..)

TOC ì‘ì—…ì„ í•˜ë©´ì„œ ì œê°€ ì‚¬ìš©í•œ ê¸°ìˆ ì— ì‘ê²Œë‚˜ë§ˆ ê¸°ì—¬í•´ì„œ ë¿Œë“¯í–ˆìŠµë‹ˆë‹¤.
Gastbyë¥¼ í•™ìŠµí•˜ëŠ” ê³¼ì •ì—ì„œ ì˜¤í”ˆ ì†ŒìŠ¤ì— ê¸°ì—¬í•˜ëŠ” ê²½í—˜ê¹Œì§€ í•  ìˆ˜ ìˆì–´ì„œ Gastbyê°€ ì €í•œí…Œ ë” íŠ¹ë³„í•˜ê²Œ ëŠê»´ì§€ë„¤ìš”.ğŸ˜„

ì´ë²ˆ ê¸€ì„ í†µí•´ Gatsbyì—ì„œ TOC ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë ¤ëŠ” ë¶„ë“¤ì—ê²Œ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ í•©ë‹ˆë‹¤.ğŸ™‡â€â™‚ï¸
