---
title: 'í˜¼ì½•ì—ì„œ ì‚¬ìš©ë˜ëŠ” React Query ì‚´í´ë³´ê¸°'
description: 'í˜¼ì½• ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ë˜ê³  ìˆëŠ” React Queryì˜ ì „ë°˜ì ì¸ ê¸°ëŠ¥ì— ëŒ€í•´ ì•Œì•„ë´…ë‹ˆë‹¤.'
date: '2023-10-22'
slug: 'honkok-react-query'
thumbnail: './images/honkok-react-query-thumbnail.png'
thumbnail_alt: 'honkok-react-query-thumbnail'
category: 'development'
---

# í˜¼ì½•ì—ì„œëŠ” React Queryê°€ ì–´ë–»ê²Œ ì“°ì´ê³  ìˆì„ê¹Œ?

<Callout>
  ğŸ’¡ í˜¼ì½• ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ë˜ê³  ìˆëŠ” React Queryì˜ ì „ë°˜ì ì¸ ê¸°ëŠ¥ì— ëŒ€í•´ ì•Œì•„ë´…ë‹ˆë‹¤. í”¼ë“œë°±ì€
  ì–¸ì œë‚˜ í™˜ì˜ì…ë‹ˆë‹¤:)
</Callout>

## React Query

`React Query`ëŠ” ì„œë²„ ë°ì´í„°ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í¸ë¦¬í•˜ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.
íŒ¨ì¹­, ìºì‹±, ì—…ë°ì´íŠ¸, ì—ëŸ¬ ì²˜ë¦¬ ë“± ë¹„ë™ê¸° í†µì‹ ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ê¸°ëŠ¥ë“¤ì„ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

ì´ì²˜ëŸ¼ í¸ë¦¬í•œ `React Query`ëŠ” í˜¼ì½• ì„œë¹„ìŠ¤ ì „ë°˜ì ìœ¼ë¡œ í™œë°œí•˜ê²Œ ì‚¬ìš©ë˜ê³  ìˆë‹¤.
ì´ì— ì´ë²ˆ ê¸€ì—ì„œëŠ” í˜¼ì½•ì—ì„œ `React Query`ê°€ ì–´ë””ì— ì“°ì´ê³  ì–´ë–»ê²Œ ì ìš©í•´ì„œ ì“°ì˜€ëŠ”ì§€ ì‚´í´ë³´ê³ ì í•œë‹¤.

## ì»¨ë²¤ì…˜ êµ¬ì¶•í•˜ê¸°

`React Query`ë¥¼ ì²˜ìŒ ì ‘í•œ íŒ€ì›ë¿ë§Œ ì•„ë‹ˆë¼ `React Query`ë¥¼ ì‚¬ìš©í•´ë³¸ ê²½í—˜ì´ ìˆëŠ” íŒ€ì› ì‚¬ì´ì—ì„œë„ ê°ì ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ ë‹¬ëë‹¤.
ê·¸ë˜ì„œ ì²˜ìŒì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì— ëŒ€í•´ì„œ ì»¨ë²¤ì…˜ì„ ë§ì¶œ í•„ìš”ê°€ ìˆì—ˆë‹¤.

ì´ë¥¼ ìœ„í•´ [ìœ„í‚¤(React Query)](https://github.com/prgrms-fe-devcourse/FEDC4_HONKOK_JunilHwang/wiki/%EA%B8%B0%EC%88%A0-%EC%8A%A4%ED%83%9D#-react-query)ì— ë¬¸ì„œí™”ë¥¼ í•˜ë©´ì„œ íŒ€ ë‚´ë¶€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” `React Query`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì„ í•˜ë‚˜ë¡œ ë§ì¶°ë‚˜ê°”ë‹¤.

ìš°ì„  `React Query`ì—ì„œ ì¤‘ìš”í•˜ê²Œ ë‹¤ë£¨ì–´ì§€ëŠ” **ì¿¼ë¦¬ í‚¤**ì— ëŒ€í•´ì„œ ì •ë¦¬ë¥¼ ì§„í–‰í–ˆë‹¤.

ê°€ì¥ ëˆˆì— ë„ëŠ” ìœ„ì¹˜ë¡œ **íŒŒì¼ ìƒë‹¨ì— ì‚¬ìš©í•˜ëŠ” í‚¤ë“¤ì„ ê°ì²´ë¡œ ê´€ë¦¬**í•˜ê³ ì í–ˆë‹¤.

```ts
const channelKeys = {
  all: ['channels'] as const,
  detail: (id: number) => [...channelKeys.all, id] as const,
  ...
};
```

ë„¤ì´ë°ê³¼ ê´€ë ¨í•´ì„œëŠ” í¬ê²Œ ë‘ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ„ê³ ì í–ˆë‹¤.

`React Query`ì˜ ì—­í• ì´ **API í•¨ìˆ˜ë¥¼ ê°ì‹¸ì„œ ê´€ë ¨ëœ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” í›…**ì˜ ëŠë‚Œì´ ë“¤ê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì´ ë„¤ì´ë°ì„ í†µì¼ì‹œì¼°ë‹¤.

- API ê´€ë ¨ í•¨ìˆ˜ ì´ë¦„ì€ `ë™ì‚¬+ëª…ì‚¬`ë¡œ í†µì¼í•œë‹¤.
- ì¿¼ë¦¬ ê´€ë ¨ í•¨ìˆ˜ ì´ë¦„ì€ `use+API ê´€ë ¨ í•¨ìˆ˜`ë¡œ í†µì¼í•œë‹¤.

ê·¸ë˜ì„œ ì´ë¥¼ `useQuery`ì™€ `useMutation`ì—ì„œ ì‚¬ìš©ëœ ì˜ˆì‹œë¥¼ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©ëœë‹¤.

**useQuery ì˜ˆì‹œ**

```ts
const getChannels = async (): Promise<Channel[]> => {
  const response = await axios.get('/channels')

  return response.data
}

export const useGetChannels = () => {
  return useQuery({ queryKey: [channelKeys.all], queryFn: getChannels, initialData: [] })
}
```

**useMutation ì˜ˆì‹œ**

```ts
const createChannel = async ({ authRequired, description, name }: Create) => {
  return await axios.post('/channels/create', {
    ...ê´€ë ¨ ì½”ë“œ
  });
};

export const useCreateChannel = () => {
  return useMutation({ mutationFn: createChannel });
};
```

ì´ë ‡ê²Œ ê¸°ë³¸ì ì¸ êµ¬ì¶•ì„ í•˜ë©´ ì‚¬ìš©í•˜ëŠ” ìª½ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê°„í¸í•˜ê²Œ ì‚¬ìš©í•˜ê³ ì í–ˆë‹¤.

```ts
const { data: channels } = useGetChannels();
const { data: posts } = useGetPosts();
...

const { mutate: createChannel } = useCreateChannel();
const { mutate: createPost } = useCreatePost();
...
```

ì—¬ê¸°ì„œ `useQuery`ë¥¼ ìƒê°í•´ë³´ë©´ **ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜**ì´ë‹¤.
ë”°ë¼ì„œ `data`ì˜ ì´ë¦„ì„ ë³€ê²½í•  ë•Œ `ëª…ì‚¬`ë§Œì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ½ê²Œ ëŠê»´ì§„ë‹¤.

`useMutation`ì˜ ê²½ìš° ë§ê·¸ëŒ€ë¡œ ë®¤í…Œì´ì…˜ì´ ë°œìƒí•˜ëŠ”, ì¦‰ **ë³€ê²½ì´ ë°œìƒí•˜ëŠ” í•¨ìˆ˜**ì´ë‹¤.
ê·¸ë˜ì„œ `mutation`ì˜ ì´ë¦„ì€ `ë™ì‚¬+ëª…ì‚¬`ë¡œ ì‚¬ìš©í•˜ëŠ”ê²Œ ìì—°ìŠ¤ëŸ½ë‹¤.

<br />

ì´ë¥¼ ì •ë¦¬í•´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ê·œì¹™ì„ ë§Œë“¤ì—ˆë‹¤.

- useQueryê´€ë ¨ í›…, useMutation ê´€ë ¨ í›… ìˆœì„œëŒ€ë¡œ ë°°ì¹˜í•œë‹¤.
- useQueryì˜ ê²½ìš° í›…ì˜ ì´ë¦„ì—ì„œ ëª…ì‚¬ë§Œì„ ì‚¬ìš©í•œë‹¤.
- useMutationì˜ ê²½ìš° í›…ì˜ ì´ë¦„ì—ì„œ ë™ì‚¬+ëª…ì‚¬ë§Œì„ ì‚¬ìš©í•œë‹¤.

## ë¬´í•œ ìŠ¤í¬ë¡¤ ì ìš©í•˜ê¸°

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/honkok-react-query/images/honkok-infinite-scroll.gif"
  alt="honkok-infinite-scroll"
/>

í˜¼ì½•ì—ì„œëŠ” ì±„ë„ë§ˆë‹¤ ê²Œì‹œë¬¼ì´ ì—¬ëŸ¬ ê°œê°€ ë‚˜ì˜¤ëŠ” ë°©ì‹ì´ë‹¤.
íš¨ìœ¨ì ì¸ ì„±ëŠ¥ì„ ìœ„í•´ì„œëŠ” ëª¨ë“  ê²Œì‹œë¬¼ì„ í•œ ë²ˆì— ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ ì•„ë‹Œ ì¼ì • ê²Œì‹œë¬¼ ê°œìˆ˜ë§Œ í˜¸ì¶œí•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í–ˆë‹¤.

### useInfiniteQuery

`React Query`ì—ì„œëŠ” ì´ì™€ ê´€ë ¨ëœ ê¸°ëŠ¥ìœ¼ë¡œ [useInfiniteQuery](https://tanstack.com/query/v4/docs/react/reference/useInfiniteQuery)ë¥¼ ì œê³µí•œë‹¤.
í˜¼ì½•ì—ì„œëŠ” APIë¥¼ ìˆ˜ì •í•˜ëŠ”ë° í•œê³„ê°€ ìˆê¸°ì— ì‚¬ìš©ë˜ëŠ” ë¶€ë¶„ì— ì ì ˆí•˜ê²Œ ë³€ê²½í•  í•„ìš”ê°€ ìˆì—ˆë‹¤.

<br />

ìš°ì„  í•˜ë‚˜ì”© ì‚¬ìš©ë˜ëŠ” ë¶€ë¶„ë“¤ì„ ì‚´í´ë³´ì.

ì‚¬ìš©ë˜ëŠ” ì¸ìëŠ” í¬ê²Œ ì„¸ ê°€ì§€ë¡œ ì²« ë²ˆì§¸ `queryKey`, ë‘ ë²ˆì§¸ `queryFn`, ì„¸ ë²ˆì§¸ `options`ìœ¼ë¡œ ì •ë¦¬í•˜ê³ ì í•œë‹¤.

ë°˜í™˜ê°’ìœ¼ë¡œëŠ” `data`, `fetchNextPage`, `fetchPreviousPage`, `hasNextPage` ë“±ì„ ë°˜í™˜í•œë‹¤.

ì„¸ ë²ˆì§¸ ì¸ìë¡œ ë“¤ì–´ê°€ëŠ” ì£¼ìš” ì˜µì…˜ì—ì„œ `getNextPageParam`, `getPreviousPageParam`ê°€ ìˆëŠ”ë° ì´ë¥¼ í™œìš©í•˜ì—¬ `pageParam`ê°’ì„ ë³€ê²½í•œë‹¤.

ë°˜í™˜ëœ `pageParam` ê°’ì„ ì´ìš©í•´ ë‹¤ì‹œ `queryFn`ê°€ ì‹¤í–‰ë˜ëŠ” ë°©ì‹ì´ë‹¤.

êµ¬ì¡°ë„ë¡œ ê°„ë‹¨í•˜ê²Œ í‘œí˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/honkok-react-query/images/infinite-scroll-structure.png"
  alt="infinite-scroll-structure"
/>

ì—¬ê¸°ì„œ `getNextPageParam`ì€ ì²« ë²ˆì§¸ ì¸ìë¡œ `lastPage`, ë‘ ë²ˆì§¸ ì¸ìë¡œ `allPage`ë¥¼ ë°›ëŠ”ë‹¤.
ê·¸ë˜ì„œ ë‚´ë¶€ì—ì„œ ì¸ìê°’ì„ í™œìš©í•˜ì—¬ ë°˜í™˜ëœ ê°’ì— ë”°ë¼ `pageParam`ì´ ê²°ì •ë˜ëŠ”ë° `undefined`ë¥¼ ë°˜í™˜í•˜ë©´ ë‹¤ìŒ í˜ì´ì§€ê°€ ì—†ëŠ” ê²½ìš°ê°€ ëœë‹¤.

ì´ëŸ¬í•œ ê°œë…ì ì¸ íë¦„ì„ í† ëŒ€ë¡œ ì½”ë“œë¥¼ êµ¬ì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ì´ ëœë‹¤.

**useInfiniteScroll.ts**

```ts
interface UseInfiniteScrollProps<T> {
  fetchData: (pageParam: number) => Promise<T[]>;
  queryKey: string;
}

const useInfiniteScroll = <T>({ fetchData, queryKey }: UseInfiniteScrollProps<T>) => {
  const { data = { pages: [], pageParams: [] }, hasNextPage, fetchNextPage } = useInfiniteQuery(
    ['posts', queryKey],
    ({ pageParam = 0 }) => fetchData(pageParam),
    {
      getNextPageParam: (lastPage, allPages) => {
        return lastPage.length === 0 ? undefined : allPages.reduce((total, page) => total + page.length, 0);
      },
      suspense: true
    }
  );
  ...IntersectionObserver ê´€ë ¨ ì½”ë“œ
}
```

**ì‚¬ìš© ì˜ˆì‹œ**

```tsx
const fetchApi = async ({ limit, offset }: Props): Promise<Data[]> => {
  const response = await snsApiClient.get(`/api/temp`, { params: { limit, offset } })

  return response.data
}

export const useFetchApi = ({ channelId, limit }: Omit<Props, 'offset'>) => {
  return useInfiniteScroll({
    fetchData: (pageParam) => fetchApi({ channelId, limit, offset: pageParam }),
  })
}

const { data } = useGetApi({ limit: 5 })

return (
  <div>
    {data.pages.map((pageData, pageIndex) => (
      <ul key={pageIndex}>
        {pageData.map((item) => (
          <li key={item.id}>{item.title}</li>
        ))}
      </ul>
    ))}
  </div>
)
```

## ì±„íŒ… ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/honkok-react-query/images/honkok-chat.gif"
  alt="honkok-chat"
/>

í˜¼ì½•ì—ì„œëŠ” ì œê³µí•˜ê³  ìˆëŠ” ì±„íŒ… ê¸°ëŠ¥ì—ì„œë„ `React Query`ê°€ ì‚¬ìš©ë˜ê³  ìˆë‹¤.

### polling

ì œí•œëœ API í™˜ê²½ì—ì„œ ì±„íŒ… ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ **í´ë§ ë°©ì‹**ìœ¼ë¡œ ë°©í–¥ì„ ì¡ì•˜ë‹¤.
ì¼ì •í•œ ì£¼ê¸°ë¥¼ ê°€ì§€ê³  ì„œë²„ì™€ ì‘ë‹µì„ ì£¼ê³  ë°›ëŠ” ë°©ì‹ìœ¼ë¡œ ì‹¤ì œ ì±„íŒ…ê³¼ ê°™ì€ ëŠë‚Œì„ ì£¼ê³ ì í–ˆë‹¤.

ë¬¼ë¡  ì§€ì†ì ìœ¼ë¡œ API í˜¸ì¶œì´ ë°œìƒí•˜ê¸°ì— ë¹„íš¨ìœ¨ì ì¸ ì¸¡ë©´ì´ ìˆì§€ë§Œ ì¼ì • ë° ì œí•œëœ í™˜ê²½ì¸ í˜„ ìƒí™©ì—ì„œëŠ” í´ë§ ë°©ì‹ì´ ì ì ˆí•˜ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.

<br />

`React Query`ì—ì„œëŠ” í´ë§ê³¼ ê´€ë ¨í•´ì„œ `refetchInterval`ì™€ `refetchIntervalInBackground`ì„ ì´ìš©í•´ì„œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
ê°ê°ì€ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

- **`refetchInterval`**: ì‹œê°„(ms)ë¥¼ ê°’ìœ¼ë¡œ ì¼ì • ì‹œê°„ë§ˆë‹¤ ìë™ìœ¼ë¡œ `refetch` ì‹¤í–‰
- **`refetchIntervalInBackground`**: `refetchInterval`ì™€ í•¨ê¼ ì‚¬ìš©ë˜ëŠ” ì˜µì…˜, íƒ­/ì°½ì´ ë°±ê·¸ë¼ìš´ë“œì— ìˆëŠ” ë™ì•ˆ ë¸Œë¼ìš°ì €ì— í¬ì»¤ìŠ¤í•˜ì§€ ì•Šì•„ë„ `refectch` ì‹¤í–‰

ê·¸ë˜ì„œ ì½”ë“œë¡œ ì ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```ts
export const useGetConversations = () => {
  return useQuery({
    queryKey: messageKeys.conversations,
    queryFn: getConversations,
    refetchInterval: 3000,
    refetchIntervalInBackground: true,
    suspense: true,
  })
}
```

ì´ë ‡ê²Œ í•˜ë©´ ì±„íŒ…ê³¼ ê´€ë ¨ëœ APIê°€ ì¼ì • ì‹œê°„ë§ˆë‹¤ í˜¸ì¶œì´ ëœë‹¤.

### ì¿¼ë¦¬ ë¬´íš¨í™”

ì´ë•Œ ì±„íŒ…ì„ ë³´ë‚´ëŠ” ìœ ì €ì˜ ì…ì¥ë„ ìƒê°í•´ë³¼ í•„ìš”ê°€ ìˆë‹¤.
ì±„íŒ…ì„ ë³´ë‚¼ ë•ŒëŠ” í´ë§ ë°©ì‹ì—ì„œ ì •í•œ 3ì´ˆë„ ê¸¸ê²Œ ëŠê»´ì§„ë‹¤.
ìì‹ ì´ ë³´ë‚¸ ì±„íŒ…ì´ ë°”ë¡œ í™”ë©´ì— ë‚˜íƒ€ë‚˜ëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ½ë‹¤.

ê·¸ë˜ì„œ **ì¿¼ë¦¬ ë¬´íš¨í™”**ë¥¼ ì ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
`invalidateQueries`ë¥¼ í†µí•´ ì¿¼ë¦¬ í‚¤ì— í•´ë‹¹í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ë¬´íš¨í™”ì‹œí‚¤ë©´ì„œ ìµœì‹  ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ê²ƒì´ë‹¤.

ì±„íŒ…ì´ ì„±ê³µì ìœ¼ë¡œ ë³´ë‚´ì¡Œì„ ë•Œ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ì½”ë“œì— ì ìš©í•  ìˆ˜ ìˆë‹¤.

```ts
export const useCreateMessage = () => {
  const queryClient = useQueryClient()

  return useMutation({
    mutationFn: createMessage,
    onSuccess: ({ data }) => {
      return queryClient.invalidateQueries({
        queryKey: messageKeys.chat(data.receiver._id),
      })
    },
  })
}
```

## undefinedë¥¼ ì—†ì• ê¸° ìœ„í•œ ê³¼ì •

ì²˜ìŒ `React Query`ë¥¼ ì‚¬ìš©í•˜ë‹¤ ë³´ë©´ ì´ˆê¸° ë°ì´í„°ê°€ `undefined`ê°€ í¬í•¨ë˜ëŠ” ê²½ìš°ë¥¼ ë§ì´ ì ‘í•˜ê²Œ ëœë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/honkok-react-query/images/react-query-undefined-example.png"
  alt="react-query-undefined-example"
/>

ì´ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šê³  `undefined`ë¥¼ í¬í•¨ì‹œí‚¤ë©´ì„œ ì½”ë“œë¥¼ êµ¬ì„±í•´ë„ ë¬¸ì œëŠ” ì—†ë‹¤.
í•˜ì§€ë§Œ ê·¸ë ‡ê²Œ ë˜ë©´ í•´ë‹¹ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ `?`ë‚˜ `&&`ê³¼ ê°™ì€ ë¶„ê¸° ì²˜ë¦¬ë¥¼ í•´ì•¼ í•´ì„œ ì½”ë“œê°€ êµ‰ì¥íˆ ì§€ì €ë¶„í•´ì§„ë‹¤.

### ë°°ì—´ ë°ì´í„°ì—ì„œì˜ ë¹ˆ ë°°ì—´ í™œìš©

ì²˜ìŒ ì ‘ê·¼í•œ ë°©ì‹ì€ `channels`ê³¼ ê°™ì€ ë°°ì—´ ë°ì´í„°ì—ì„œ ê¸°ë³¸ê°’ìœ¼ë¡œ ë¹ˆ ë°°ì—´ì„ ë„£ëŠ” ë°©ì‹ì´ë‹¤.

```ts
export const useGetChannels = () => {
  return useQuery({ queryKey: channelKeys.all, queryFn: getChannels, initialData: [] })
}
```

ì´ë ‡ê²Œ í•˜ë©´ ë°°ì—´ ë°ì´í„°ì— í•œí•´ì„œëŠ” `undefined`ë¥¼ ì—†ì–´ì§€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/honkok-react-query/images/react-query-array-example.png"
  alt="react-query-array-example"
/>

ë‹¹ì—°íˆ ì´ëŸ¬í•œ ë°©ì‹ì€ ê°ì²´ì™€ ê°™ì€ ë‹¨ì¼ ë°ì´í„° í˜•ì‹ì—ì„œë§Œ ì ìš©í•  ìˆ˜ ìˆì–´ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.
ê·¸ë˜ì„œ ì‚¬ìš©í•œì§€ ì–¼ë§ˆ ì§€ë‚˜ì§€ ì•Šì•„ ë³€ê²½ì´ í•„ìš”í–ˆë‹¤.

### suspenseì˜ í™œìš©

ë‹¤ì‹œ ëŒì•„ì™€ì„œ `React Query`ì—ì„œ `undefined`ê°€ ë°œìƒí•œ ì´ìœ ì— ëŒ€í•´ ìƒê°í•´ ë³¼ í•„ìš”ê°€ ìˆë‹¤.
ë¹„ë™ê¸° ë™ì‘ì´ê¸°ì— `undefined`ë¥¼ ê³ ë ¤í•˜ëŠ” ê²ƒì€ ì–´ì°Œë³´ë©´ ë‹¹ì—°í•œ ì¸¡ë©´ì´ë‹¤.

í•˜ì§€ë§Œ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ì…ì¥ì—ì„œ ë°ì´í„°ê°€ ì—†ëŠ” ìƒí™©ì„ ê³ ë ¤í•  í•„ìš”ê°€ ìˆì„ê¹Œ?

ìš°ë¦¬ê°€ ì‘ì„±í•˜ëŠ” ì½”ë“œ ë‚´ë¶€ì—ì„œëŠ” ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì˜¨ ê²°ê³¼ë§Œì„ ìƒê°í•˜ëŠ” ê²ƒì´ í¸ë¦¬í•˜ë‹¤.

<br />

ì´ë¥¼ ìœ„í•´ `suspense`, `error boundary`ë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤.
ë¡œë”©ê³¼ ì‹¤íŒ¨ì— ëŒ€í•œ ê³ ë ¤ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë‚´ë¶€ì—ì„œ ìš°ë¦¬ì˜ ê´€ì‹¬ì‚¬ê°€ ì•„ë‹ˆë‹¤.
ì´ëŠ” ì™¸ë¶€ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ í•œë‹¤.

ì½”ë“œ ë‚´ë¶€ì—ì„œëŠ” ì˜¤ì§ ë°ì´í„°ê°€ ìˆëŠ” ì„±ê³µí•œ ìƒí™©ë§Œì„ ê°€ì •í•˜ì—¬ ì„ ì–¸ì ì¸ í˜•íƒœì˜ ì½”ë“œë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.

<br />

`React Query`ì—ì„œëŠ” ê°„ë‹¨í•˜ê²Œ `suspense`ë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤.

```ts
export const useGetPost = (postId: string) => {
  return useQuery({
    queryKey: postKeys.post(postId),
    queryFn: () => getPost(postId),
    suspense: true,
  })
}
```

í•˜ì§€ë§Œ ì´ë ‡ê²Œ `suspense`ë¥¼ ì‚¬ìš©í•´ë„ `useGetPost`ë¥¼ í†µí•´ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ í™•ì¸í–ˆì„ ë•Œ ì•„ì§ `undefined`ê°€ ìˆê²Œ ëœë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/honkok-react-query/images/react-query-suspense-undefined-example.png"
  alt="react-query-suspense-undefined-example"
/>

ì´ëŠ” ì•„ì§ `React Query` (ë²„ì „4) ì—ì„œ `suspense`ì— ëŒ€í•´ íƒ€ì…ì ìœ¼ë¡œ ì§€ì›ì„ í•˜ì§€ ì•Šì•„ì„œ ë°œìƒí•œ ê²ƒì´ë‹¤.

ì´ì— ëŒ€í•œ í•´ê²° ë°©ì•ˆìœ¼ë¡œ ê´€ë ¨ ìë£Œë¥¼ ì°¾ì•„ë´¤ì„ ë•Œ ëŒ€í‘œì ìœ¼ë¡œ ë‘ ê°€ì§€ ë°©ë²•ì„ ì ìš©í•  ìˆ˜ ìˆì—ˆë‹¤.

- `useQuery`ë¥¼ í™œìš©í•˜ì—¬ `undefined`ë¥¼ ì—†ì• ëŠ” ì»¤ìŠ¤í…€ í›… ë§Œë“¤ê¸°
- íƒ€ì…ì ìœ¼ë¡œ `undefined`ë¥¼ ì—†ë‚´ëŠ” `assert` êµ¬ë¬¸ ì‚¬ìš©í•˜ê¸°

<br />

ì—¬ê¸°ì„œ ì–´ë–¤ ë°©ì‹ì„ íƒí• ê¹Œ ê³ ë¯¼ì´ ë˜ì—ˆëŠ”ë° ë‹¤ìŒê³¼ ê°™ì€ ì´ìœ ë“¤ë¡œ í˜¼ì½•ì—ì„œëŠ” `assert` êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤.

- ì´‰ë°•í•œ ì¼ì •ì—ì„œ `React Query` ë‚´ë¶€ ì½”ë“œë¥¼ í•™ìŠµí•˜ê³  ì˜ˆê¸°ì¹˜ ëª»í•œ ìƒí™©ì„ ëŒ€ì²˜í•˜ê¸°ì—ëŠ” ë¶€ì¡±í•œ ì‹œê°„
- `React Query`ê°€ ë‚¯ì„  íŒ€ì›ë“¤ì—ê²Œ ê°€ì¥ ë¹ ë¥´ê³  ì‰½ê²Œ ì„¤ëª…í•˜ë©´ì„œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•

### assert êµ¬ë¬¸

`assert` êµ¬ë¬¸ì€ ê°€ì¥ ë¹ ë¥´ë©´ì„œë„ ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ìœ¼ë¡œ ë³´ì—¬ì¡Œë‹¤.
íƒ€ì…ì ìœ¼ë¡œë§Œ ì²˜ë¦¬í•˜ë©´ ë˜ê¸°ì— `React Query`ì— ëŒ€í•œ ì´í•´ì—†ì´ë„ ì‚¬ìš©ì´ ê°€ëŠ¥í•´ì„œ ì–´ë””ì— ì–´ë–»ê²Œ ì“°ì´ëŠ”ì§€ë§Œ ì„œë¡œ ì‹ ê²½ì“°ë©´ ë˜ì—ˆë‹¤.

`assert` í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¤ì—ˆë‹¤.

```ts
function assert(condition: unknown, errorMessage?: string): asserts condition {
  if (!condition) {
    console.log(condition)
    throw new Error(errorMessage || 'condition ì¡°ê±´ì´ trueê°€ ì•„ë‹™ë‹ˆë‹¤.')
  }
}

export default assert
```

ì‚¬ìš©í•  ë•ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ `assert`ì— ë°ì´í„°ë¥¼ ë„£ìœ¼ë©´ ëœë‹¤.
ê·¸ëŸ¬ë©´ `undefined`ê°€ ì—†ì–´ì§€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/honkok-react-query/images/react-query-assert-example.png"
  alt="react-query-assert-example"
/>

### useSuspenseQuery

`assert` êµ¬ë¬¸ë§Œìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸°ì—ëŠ” ì•„ì‰¬ì›€ì´ ë‚¨ì•„ì„œ í˜¼ì½• í”„ë¡œì íŠ¸ ì¼ì •ì´ ëë‚˜ê³  ì¶”ê°€ì ìœ¼ë¡œ í•™ìŠµì„ í•´ë³´ì•˜ë‹¤.
ê°„ë‹¨í•˜ê²Œ `useSuspenseQuery`ë¥¼ ë§Œë“¤ì–´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì“¸ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

ìš°ì„  ê¸°ë³¸ì ìœ¼ë¡œ `useQuery`ì— ëŒ€í•œ íƒ€ì…ì„ ë°›ì•„ ìƒˆë¡œìš´ ì¿¼ë¦¬ í›…ì„ ë§Œë“¤ì.

`Omit`ì„ í†µí•´ ì—ëŸ¬ì™€ íŒ¨ì¹­ì— ëŒ€í•œ ê³ ë ¤ëŠ” ì œì™¸í•˜ê³  ì„±ê³µê³¼ ë¡œë”©ì— ëŒ€í•œ ìƒí™©ë§Œì„ ê³ ë ¤í•˜ë„ë¡ í•œë‹¤.

```ts
interface BaseUseSuspenseQueryResult<TData = unknown>
  extends Omit<UseQueryResult<TData>, 'error' | 'isError' | 'isFetching'> {
  status: 'success' | 'loading'
}
```

ë‹¤ìŒìœ¼ë¡œ ì„±ê³µê³¼ ë¡œë”©ì— ëŒ€í•œ íƒ€ì…ì„ êµ¬ì„±í•œë‹¤.

```ts
interface UseSuspenseQueryResultOnSuccess<TData>
  extends BaseUseSuspenseQueryResult<TData> {
  data: TData
  isLoading: false
  isSuccess: true
  status: 'success'
}
interface UseSuspenseQueryResultOnLoading extends BaseUseSuspenseQueryResult {
  data: undefined
  isLoading: true
  isSuccess: false
  status: 'loading'
}
```

`suspense`ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ í•˜ëŠ” ì»¤ìŠ¤í…€ í›…ì´ê¸° ë•Œë¬¸ì— ì¿¼ë¦¬ ì˜µì…˜ì—ì„œ `suspense`ë¥¼ ì œê±°í•œ íƒ€ì…ì„ ì •ì˜í•œë‹¤.

```ts
type UseSuspenseQueryOptions<
  TQueryFnData = unknown,
  TError = unknown,
  TData = TQueryFnData,
  TQueryKey extends QueryKey = QueryKey,
> = Omit<UseQueryOptions<TQueryFnData, TError, TData, TQueryKey>, 'suspense'>
```

ì´ì œ `useSuspenseQuery`ì— ëŒ€í•œ íƒ€ì…ì„ ì •ì˜í•˜ë©´ ëœë‹¤.

ì—¬ê¸°ì„œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ê°œë…ìœ¼ë¡œ **í•¨ìˆ˜ ì˜¤ë²„ë¡œë”©**ì´ ì ìš©ëœë‹¤.
ë™ì¼í•œ ì´ë¦„ì— ë§¤ê°œ ë³€ìˆ˜ë§Œ ë‹¤ë¥¸ ì—¬ëŸ¬ ë²„ì „ì˜ í•¨ìˆ˜ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤.

ë˜í•œ, ì¿¼ë¦¬ ì˜µì…˜ì—ì„œ `enabled`ê°€ `false`ì¼ ë•ŒëŠ” ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ë„ ê³ ë ¤í•´ì£¼ì–´ì•¼ í•œë‹¤.
ë°˜ëŒ€ë¡œ `enabled`ê°€ `true`ì´ë©´ ì„±ê³µí•œ ìƒí™©ë§Œ ê°€ì •í•˜ë©´ ëœë‹¤.

```ts
// enabledë¥¼ trueë¡œ ê°€ì •í–ˆê¸° ë•Œë¬¸ì— ì„±ê³µ
function useSuspenseQuery<
  TQueryFnData = unknown,
  TError = unknown,
  TData = TQueryFnData,
  TQueryKey extends QueryKey = QueryKey,
>(
  options: Omit<
    UseSuspenseQueryOptions<TQueryFnData, TError, TData, TQueryKey>,
    'enabled'
  > & { enabled?: true },
): UseSuspenseQueryResultOnSuccess<TData>

// enabledë¥¼ falseë¡œ ê°€ì •í–ˆê¸° ë•Œë¬¸ì— ë¡œë”©
function useSuspenseQuery<
  TQueryFnData = unknown,
  TError = unknown,
  TData = TQueryFnData,
  TQueryKey extends QueryKey = QueryKey,
>(
  options: Omit<
    UseSuspenseQueryOptions<TQueryFnData, TError, TData, TQueryKey>,
    'enabled'
  > & { enabled: false },
): UseSuspenseQueryResultOnLoading

// ì„±ê³µ í˜¹ì€ ë¡œë”©
function useSuspenseQuery<
  TQueryFnData = unknown,
  TError = unknown,
  TData = TQueryFnData,
  TQueryKey extends QueryKey = QueryKey,
>(
  options: UseSuspenseQueryOptions<TQueryFnData, TError, TData, TQueryKey>,
): UseSuspenseQueryResultOnSuccess<TData> | UseSuspenseQueryResultOnLoading
```

ë§ˆì§€ë§‰ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì»¤ìŠ¤í…€í›…ì„ ì •ì˜í•˜ë©´ ëœë‹¤.

```ts
function useSuspenseQuery<
  TQueryFnData = unknown,
  TError = unknown,
  TData = TQueryFnData,
  TQueryKey extends QueryKey = QueryKey,
>(
  options: UseSuspenseQueryOptions<TQueryFnData, TError, TData, TQueryKey> & {
    enabled?: boolean
  },
) {
  const useQueryResult = useQuery({ ...options, suspense: true })

  return useQueryResult as
    | UseSuspenseQueryResultOnSuccess<TData>
    | UseSuspenseQueryResultOnLoading
}

export default useSuspenseQuery
```

ì´ë ‡ê²Œ ì»¤ìŠ¤í…€í›…ì„ êµ¬í˜„í•˜ê³  ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ `undefined`ê°€ ì œê±°ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```ts
export const useGetPost = (postId: string) => {
  return useSuspenseQuery({
    queryKey: postKeys.post(postId),
    queryFn: () => getPost(postId),
  })
}
```

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/honkok-react-query/images/use-suspense-query-example.png"
  alt="use-suspense-query-example"
/>

ì´ëŸ¬í•œ `useSuspenseQuery`ëŠ” `React Query` [ë²„ì „5](https://tanstack.com/blog/announcing-tanstack-query-v5)ì—ì„œëŠ” ê³µì‹ì ìœ¼ë¡œ ì§€ì›í•˜ê³  ìˆë‹¤.
ì´ì œ ë²„ì „5ê°€ ì£¼ìš” ë²„ì „ì´ ë˜ì—ˆìœ¼ë‹ˆ í–¥í›„ì—ëŠ” ì§€ì›í•˜ëŠ” í›…ì„ ì‚¬ìš©í•˜ì.

## ì°¸ê³  ë¬¸ì„œ

- [TanStack](https://tanstack.com)
- [TkDodo's blog](https://tkdodo.eu/blog)
- [assertion-functions](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#assertion-functions)
- [Suspensive](https://suspensive.org)
