---
title: 'ì„œë¹„ìŠ¤ì— ì•ˆì „ì¥ì¹˜ ë§ˆë ¨í•˜ê¸° - ErrorBoundary ì ìš©'
description: 'ErrorBoundaryë¥¼ í†µí•´ ì„œë¹„ìŠ¤ì˜ ì•ˆì „ì„±ì„ ë”í•œ ê²½í—˜ì„ ê³µìœ í•©ë‹ˆë‹¤.'
date: '2024-07-23'
slug: 'last-safety-error-boundary'
thumbnail: './images/last-safety-error-boundary-thumbnail.png'
thumbnail_alt: 'Last Safety ErrorBoundary Thumbnail'
category: 'development'
type: 'post'
---

# ì—ëŸ¬ë¥¼ ë§ˆì£¼í•˜ë©°

<Callout>ğŸ’¡ ErrorBoundaryë¥¼ í†µí•´ ì„œë¹„ìŠ¤ì˜ ì•ˆì „ì„±ì„ ë”í•œ ê²½í—˜ì„ ê³µìœ í•©ë‹ˆë‹¤.</Callout>

í”„ë¡œì íŠ¸ íŠ¹ì„±ìƒ ì—¬ëŸ¬ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ê´€ë¦¬í•˜ë‹¤ ë³´ë‹ˆ ì™¸ë¶€ ê°œë°œìê°€ í”„ë¡œì íŠ¸ ì½”ë“œì— ì‘ì—…í•˜ëŠ” ê²½ìš°ë„ ë¹ˆë²ˆí•˜ê²Œ ë°œìƒí•œë‹¤.

ê·¸ë˜ì„œ í•­ìƒ ì˜ˆìƒí•˜ì§€ ëª»í•œ ì—ëŸ¬ ìƒí™©ì„ ë§ˆì£¼í•˜ê²Œ ëœë‹¤.

## ë¬¸ì œ ìƒí™©

> `Next.js Pages Router` ë°©ì‹ê³¼ ê´€ë ¨ëœ ê¸€ì…ë‹ˆë‹¤.

<br />

í˜„ì¬ `Next.js` ë¥¼ ì‚¬ìš©í•˜ê¸° ìˆê¸° ë•Œë¬¸ì— ì¼ë°˜ì ì¸ ì—ëŸ¬ ìƒí™©ì— ëŒ€í•´ì„œëŠ” [\_error.tsx](https://nextjs.org/docs/pages/building-your-application/routing/custom-error#more-advanced-error-page-customizing) ë¡œ ëŒ€ì²˜í•˜ê³  ìˆì—ˆë‹¤.

<br />

**\_error.tsx**

```ts
function Error({ statusCode }) {
	... // statusCodeì— ë”°ë¼ ì—ëŸ¬ í™”ë©´ì„ êµ¬ì„±í•©ë‹ˆë‹¤.
}

Error.getInitialProps = ({ res, err }) => {
  const statusCode = res ? res.statusCode : err ? err.statusCode : null
  return { statusCode }
}

export default Error
```

í•˜ì§€ë§Œ `_error.tsx` ë¡œë„ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆëŠ”ë° **ëŸ°íƒ€ì„ ì—ëŸ¬**ê°€ í•´ë‹¹ëœë‹¤.

<br />

ëŒ€í‘œì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ íƒ€ì… ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/last-safety-error-boundary/images/local-type-error.png"
  alt="ë¡œì»¬ í™˜ê²½ íƒ€ì… ì—ëŸ¬"
/>

ì´ ì½”ë“œê°€ ë°°í¬ í™˜ê²½ê¹Œì§€ ë°˜ì˜ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì´ ì´ˆë˜ëœë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/last-safety-error-boundary/images/deploy-type-error.png"
  alt="ë°°í¬ í™˜ê²½ íƒ€ì… ì—ëŸ¬"
/>

ë°°í¬ ê³¼ì •ì—ì„œ ë¹Œë“œëŠ” ì˜ ë˜ì—ˆì§€ë§Œ ì˜ˆìƒì¹˜ ëª»í•œ ì—ëŸ¬ í™”ë©´ì´ ë“±ì¥í•´ì„œ ì²˜ìŒ ì ‘í•˜ê²Œ ë˜ë©´ ë§ì´ ë‹¹í™©ìŠ¤ëŸ½ë‹¤. ğŸ˜µ

ì˜¤ë¥˜ì— ëŒ€í•œ ë‚´ìš©ë„ í™”ë©´ì— í¬í•¨ë˜ì–´ ìˆì§€ ì•Šë‹¤. ê·¸ë˜ì„œ ì–´ë””ê°€ ì˜ëª» ë˜ì—ˆëŠ”ì§€ í™”ë©´ë§Œ ë´¤ì„ ë•Œ ì°¾ê¸° í˜ë“¤ë‹¤.

ê²°êµ­ ë¡œì»¬ í™˜ê²½ì—ì„œ ë‹¤ì‹œ í™•ì¸í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•˜ëŠ”ë° ì´ ê³¼ì •ì´ êµ‰ì¥íˆ ë§ì€ ì‹œê°„ì„ ì†Œìš”í•˜ê²Œ ë§Œë“ ë‹¤.

ì´ëŸ¬í•œ ìƒí™©ì„ ë§‰ê¸° ìœ„í•´ **ìµœì†Œí•œì˜ ì•ˆì „ ì¥ì¹˜**ë¼ë„ í•„ìš”í•˜ë‹¤ëŠ” ìƒê°ì„ í•˜ê²Œ ë˜ì—ˆë‹¤.

## ErrorBoundary

> Fault tolerance is the property that enables a system to continue operating properly in the event of the failure of some (one or more faults within) of its components.

<br />

`React`ì—ì„œëŠ” ë Œë”ë§ ë„ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí•  ë•Œ ìµœì†Œí•œì˜ UIë¥¼ í‘œì‹œí•  ìˆ˜ ìˆëŠ” ë„êµ¬ë¡œ `ErrorBoundary`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
ê³µì‹ ë¬¸ì„œì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì œê³µí•œë‹¤.

<br />

**ErrorBoundary ì˜ˆì œ ì½”ë“œ**

```js
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props)

    // Define a state variable to track whether is an error or not
    this.state = { hasError: false }
  }
  static getDerivedStateFromError(error) {
    // Update state so the next render will show the fallback UI

    return { hasError: true }
  }
  componentDidCatch(error, errorInfo) {
    // You can use your own error logging service here
    console.log({ error, errorInfo })
  }
  render() {
    // Check if the error is thrown
    if (this.state.hasError) {
      // You can render any custom fallback UI
      return (
        <div>
          <h2>Oops, there is an error!</h2>
          <button type="button" onClick={() => this.setState({ hasError: false })}>
            Try again?
          </button>
        </div>
      )
    }

    // Return children components in case of no error

    return this.props.children
  }
}

export default ErrorBoundary
```

<br />

`ErrorBoundary`ì˜ ì£¼ìš” ì½”ë“œë¥¼ í•œ ë²ˆ ì•Œì•„ë³´ì.

### getDerivedStateFromError

ì˜¤ë¥˜ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ ì‚¬ìš©ìì—ê²Œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆëŠ” ì—­í• ì„ í•œë‹¤.
ë Œë”ë§ ë„ì¤‘ ìì‹ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ í˜¸ì¶œë˜ëŠ” íë¦„ìœ¼ë¡œ ì´ë¥¼ í†µí•´ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆê²Œ ëœë‹¤.

<br />

íŒŒë¼ë¯¸í„°ë¡œ `error`ë¥¼ ë°›ìœ¼ë©° ì¼ë°˜ì ìœ¼ë¡œëŠ” `Error`ì˜ ì¸ìŠ¤í„´ìŠ¤ì´ì§€ë§Œ,
ë¬¸ìì—´ì´ë‚˜ `null`ì„ í¬í•¨í•œ ëª¨ë“  ê°’ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.
ë°˜í™˜ ê°’ì€ ì»´í¬ë„ŒíŠ¸ì— ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•  ìƒíƒœë¥¼ ë°˜í™˜í•˜ë©´ ëœë‹¤.

<br />

ì£¼ì˜í•  ì ìœ¼ë¡œ `static getDerivedStateFromError`ì€ ìˆœìˆ˜ í•¨ìˆ˜ì´ì–´ì•¼ í•œë‹¤.
ì‚¬ì´ë“œ ì´í™íŠ¸ê°€ í•„ìš”í•˜ë©´ `componentDidCatch`ë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤.

<br />

### componentDidCatch

ì—ëŸ¬ ë°œìƒ ì‹œ ì¶”ê°€ ë¡œì§ì„ êµ¬ì„±í•  ìˆ˜ ìˆëŠ” ì—­í• ì„ í•œë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ ì—ëŸ¬ë¥¼ ë¡œê¹…í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

<br />

íŒŒë¼ë¯¸í„°ë¡œ `error`ì™€ `info`ë¥¼ ë°›ëŠ”ë‹¤.

`error`ëŠ” `getDerivedStateFromError`ì˜ `error`ì²˜ëŸ¼ ì¼ë°˜ì ìœ¼ë¡œëŠ” `Error`ì˜ ì¸ìŠ¤í„´ìŠ¤ì´ì§€ë§Œ,
ë¬¸ìì—´ì´ë‚˜ `null`ì„ í¬í•¨í•œ ëª¨ë“  ê°’ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.

`info`ëŠ” ì˜¤ë¥˜ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´ê°€ í¬í•¨ëœ ê°ì²´ì´ë‹¤.
`componentStack` í•„ë“œì˜ ê²½ìš°ì—ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•œ ì»´í¬ë„ŒíŠ¸ì˜ ìŠ¤íƒ ì¶”ì , ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì˜ ì´ë¦„ ë° ì†ŒìŠ¤ ìœ„ì¹˜ í¬í•¨ëœë‹¤ê³  í•œë‹¤.

<br />

`componentDidCatch`ì—ì„œëŠ” ì–´ëŠ ê²ƒë„ ë°˜í™˜í•˜ì§€ ì•ŠëŠ”ë‹¤.

<br />

## ì»¤ìŠ¤í…€í•˜ê²Œ ì‚¬ìš©í•˜ê¸°

ì˜ˆì œ ì½”ë“œë¥¼ ë´¤ì„ ë•Œ ê·¸ëŒ€ë¡œ ì“°ê¸°ì—ëŠ” ì•„ì‰½ë‹¤.
**ì¬ì‚¬ìš©ì„±ì„ ë†’ì´ê³  íƒ€ì…ì„ ì ìš©**í•  í•„ìš”ê°€ ìˆë‹¤.

ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤([react-error-boundary](https://github.com/bvaughn/react-error-boundary), [suspensive](https://github.com/toss/suspensive))ë„ ì¡´ì¬í•˜ì§€ë§Œ ìš°ì„  ê°€ë³ê²Œ ì“°ê³  ì‹¶ì—ˆë‹¤.
í”„ë¡œì íŠ¸ì— ìƒˆë¡œìš´ ì˜ì¡´ì„±ì´ ì¶”ê°€ë˜ëŠ”ê²Œ ë¶€ë‹´ìŠ¤ëŸ¬ìš´ ìƒí™©ì´ì—ˆë‹¤.
ë”°ë¼ì„œ ì˜¤í”ˆ ì†ŒìŠ¤ì—ì„œ êµ¬í˜„ëœ ì½”ë“œë¥¼ ì°¸ê³ í•˜ì—¬ í˜„ì¬ ìš”êµ¬ ìƒí™©ì— ë§ê²Œ ê°„ë‹¨í•œ `ErrorBoundary`ë¥¼ ë§Œë“¤ì–´ë³´ì.

<br />

í¬ê²Œ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ê²ƒì´ë‹¤.

- `fallback`: ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ë³´ì—¬ì¤„ ì»´í¬ë„ŒíŠ¸
- `reset`: ì¬ì‹¤í–‰ í•¨ìˆ˜
- `onError`: ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ì‹¤í–‰ì‹œí‚¤ëŠ” í•¨ìˆ˜

<br />

ì½”ë“œë¡œ êµ¬ì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

<br />

**ErrorBoundary ì½”ë“œ**

```ts
import React, { Component, ErrorInfo, FunctionComponent, ReactNode } from 'react'

interface ErrorBoundaryFallbackProops<TError extends Error = Error> {
  error: TError
  reset: () => void
}

interface ErrorBoundaryProps {
  children?: ReactNode
  onError?(error: Error, info: ErrorInfo): void
  onReset?(): void
  fallback: ReactNode | FunctionComponent<ErrorBoundaryFallbackProops>
}

type ErrorBoundaryState<TError extends Error = Error> =
  | { isError: true; error: TError }
  | { isError: false; error: null }

const initialErrorBoundaryState: ErrorBoundaryState = {
  isError: false,
  error: null,
}

class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { isError: true, error }
  }

  state: ErrorBoundaryState = initialErrorBoundaryState

  componentDidUpdate(
    prevProps: Readonly<ErrorBoundaryProps>,
    prevState: Readonly<ErrorBoundaryState<Error>>,
    snapshot?: any,
  ) {
    const { isError } = this.state

    if (isError && prevState.isError) {
      this.reset() // ì¬ì‹¤í–‰ í•¨ìˆ˜
    }
  }

  componentDidCatch(error: Error, into: ErrorInfo) {
    console.error('Uncaught error:', error, into) // ì—ëŸ¬ ë¡œê¹…
    this.props.onError?.(error, into) // ì—ëŸ¬ ë°œìƒ ì‹œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜
  }

  reset = () => {
    this.props.onReset?.()
    this.setState(initialErrorBoundaryState)
  }

  render() {
    const { children, fallback } = this.props
    const { error, isError } = this.state

    let childrenOrFallback = children

    if (isError) {
      if (typeof this.props.fallback === 'undefined') {
        if (process.env.NODE_ENV === 'development') {
          console.error('ErrorBoundary requires a defined fallback.')
        }

        throw error
      }

      if (typeof fallback === 'function') {
        const FallbackComponent = fallback
        childrenOrFallback = <FallbackComponent error={error} reset={this.reset} /> // ì—ëŸ¬ ë°œìƒ ì‹œ í‘œì‹œí•  ì»´í¬ë„ŒíŠ¸
      } else {
        childrenOrFallback = fallback
      }
    }

    return childrenOrFallback
  }
}

export default ErrorBoundary
```

<br />

ì´ë ‡ê²Œ êµ¬ì„±í•œ ì½”ë“œë¥¼ í”„ë¡œì íŠ¸ì— ì ìš©í•´ë³´ì.

**\_app.tsx**

```tsx
<ErrorBoundary
  fallback={({ error, reset }) => (
    <GlobalErrorContainer errorMessage={error.message} onReset={reset} />
  )}
>
  ...
  <Components {...pageProps} />
</ErrorBoundary>
```

<br />

ì´ì œ ë‹¤ìŒê³¼ ê°™ì´ í™”ë©´ì„ êµ¬ì„±í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/last-safety-error-boundary/images/error-boundary-screen.png"
  alt="ErrorBoundary í™”ë©´"
/>

### ë§ˆë¬´ë¦¬

ì´ë²ˆì— `ErrorBoundary` ë¥¼ ë„ì…í•˜ë©´ì„œ ë‹¤ìŒê³¼ ê°™ì€ íš¨ê³¼ë¥¼ ê¸°ëŒ€í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

- ìµœì†Œí•œì˜ ì•ˆì „ ì¥ì¹˜ ë§ˆë ¨
- QA ê³¼ì •ì—ì„œ ë¹ ë¥¸ ì›ì¸ íŒŒì•…
- ì—ëŸ¬ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ê´€ë¦¬í•´ì„œ ì½”ë“œ ë‚´ ê´€ì‹¬ì‚¬ ë¶„ë¦¬

<br />

ì¢€ ë” ì•Œì•„ë³´ë‹ˆ `app router` ë°©ì‹ì˜ [error-handling](https://nextjs.org/docs/app/building-your-application/routing/error-handling)ì—ì„œëŠ” `error.tsx` `global-error.tsx` ë°©ì‹ìœ¼ë¡œ ëŒ€ì²˜ê°€ ê°€ëŠ¥í•´ì„œ ë” í¸ë¦¬í•˜ê²Œ ì ìš©í•  ìˆ˜ ìˆì–´ ë³´ì¸ë‹¤. ğŸ§

## ì°¸ê³  ë¬¸ì„œ

- [Catching rendering errors with an error boundary](https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary)
- [static getDerivedStateFromError(error)](https://react.dev/reference/react/Component#static-getderivedstatefromerror)
- [componentDidCatch(error, info)](https://react.dev/reference/react/Component#componentdidcatch)
