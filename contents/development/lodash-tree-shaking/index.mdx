---
title: 'lodashê°€ ë„ˆë¬´ í°ë°?! - Tree Shakingìœ¼ë¡œ ê°œì„ í•˜ê¸°'
description: 'ê¸°ì¡´ lodash ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ lodash-esë¡œ êµì²´í•œ ê³¼ì •ì—ì„œ í•™ìŠµí•œ ë‚´ìš©ì„ ê¸°ë¡í•©ë‹ˆë‹¤.'
date: '2025-01-19'
slug: 'lodash-tree-shaking'
thumbnail: './images/lodash-tree-shanking-thumbnail.png'
thumbnail_alt: 'Lodash Tree Shaking Thumbnail'
category: 'development'
type: 'post'
---

<Callout>
  ğŸ’¡ lodashì—ì„œ lodash-esë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ëŠ” ê³¼ì •ì—ì„œ í•™ìŠµí•œ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤. í”¼ë“œë°±ì€
  ì–¸ì œë‚˜ í™˜ì˜ì…ë‹ˆë‹¤:)
</Callout>

## bundle-analyzerë¡œ ë³¸ lodash

í”„ë¡œì íŠ¸ì— `bundle-analyzer`ì„ ì ìš©í•˜ë©´ì„œ ë²ˆë“¤ ê´€ë ¨ ì§€í‘œë¥¼ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤.

(ê´€ë ¨ ê¸€: [ìµœì í™” ì²«ê±¸ìŒ ë‚´ë”›ê¸°](https://jgjgill-blog.netlify.app/road/2024-12-25/))

<br />

ì´ë•Œ í”„ë¡œì íŠ¸ ë‚´ ë§ì€ ë²ˆë“¤ ì‚¬ì´ì¦ˆë¥¼ ì°¨ì§€í•˜ëŠ” ê²ƒ ì¤‘ `lodash`ê°€ ëˆˆì— ë„ì—ˆë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/bundle-analyzer-lodash.png"
  alt="Bundle Analyzer lodash ì§€í‘œ"
/>

<br />

ì²˜ìŒ ë´¤ì„ ë•Œ ì§€í‘œê°€ êµ‰ì¥íˆ ë¶ˆí¸í•˜ê²Œ ëŠê»´ì¡Œë‹¤. ğŸ¤”

í”„ë¡œì íŠ¸ì—ì„œ `lodash`ë¥¼ ë§¤ìš° ê°€ë³ê²Œ ì‚¬ìš©í•˜ê³  ìˆì—ˆë˜ ìƒí™©ì¸ë°, (3ê°œì˜ í•¨ìˆ˜ë§Œ í˜¸ì¶œ)

ì¸¡ì •ëœ ì‚¬ì´ì¦ˆê°€ ë¬´ë ¤ 562KBë¡œ ì¡íˆëŠ” ê²ƒì´ë‹¤. ğŸ˜µâ€ğŸ’«

<br />

ë§ˆì¹˜ `lodash`ì˜ ëª¨ë“  í•¨ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ëŠë‚Œì´ ë“¤ì—ˆë‹¤.

ë‚´ê°€ ì‚¬ìš©í•œ í•¨ìˆ˜ë§Œì„ ë²ˆë“¤ì— í¬í•¨ì‹œí‚¬ ìˆ˜ëŠ” ì—†ì—ˆì„ê¹Œ?

## Tree Shaking

<div style={{ display: 'flex', justifyContent: 'center' }}>
  <Image
    height="400"
    src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/tree-shaking.png"
    alt="Tree Shaking"
  />
</div>

íŠ¸ë¦¬ì‰ì´í‚¹ì€ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì½”ë“œ(`dead code`)ë¥¼ ì œê±°í•˜ëŠ” ìµœì í™” ê¸°ë²•ì´ë‹¤.

ë¹Œë“œ ê³¼ì •ì—ì„œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ëª¨ë“ˆì€ ë²ˆë“¤ì— í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤.

### ì •ì  ëª¨ë“ˆ êµ¬ì¡°ì—ì„œì˜ ì°¨ì´

ê¸°ì¡´ `CommonJS`ëŠ” ì •ì  êµ¬ì¡°ë¡œ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤.

ë‹¤ìŒ 2ê°œì˜ ì˜ˆì‹œëŠ” `CommonJS`ì—ì„œ **ì½”ë“œë¥¼ ì‹¤í–‰í•´ì•¼ì§€ ë¬´ì—‡ì„ `import`í•˜ê³  `export`í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆëŠ” ë‚´ìš©**ì´ë‹¤.

<br />

```ts
var logger

if (Math.random()) {
  logger = require('winston')
} else {
  logger = require('pino')
}
```

<br />

```ts
if (Math.random()) {
    exports.baz = Â·Â·Â·;
}
```

<br />

ì¦‰ ë™ì  êµ¬ì¡°ë¡œ ëŸ°íƒ€ì„ì—ì„œë„ ì–¸ì œë“ ì§€ ë³€ê²½ë  ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

<br />

ë°˜ë©´ `ES Modules` ë°©ì‹ì—ì„œëŠ” **ì •ì  êµ¬ì¡°ë¥¼ í†µí•´ ì»´íŒŒì¼ ì‹œì ì— `import`, `export`ë¥¼ ê²°ì •**í•  ìˆ˜ ìˆë‹¤.

ì¡°ê±´ë¶€ë¡œ ë¡œë“œë˜ëŠ” ëª¨ë“ˆì„ ê³ ë ¤í•  í•„ìš”ê°€ ì—†ë‹¤.

ê·¸ë¦¬ê³  `import`ëŠ” `export`ë¥¼ ë³µì‚¬í•  í•„ìš” ì—†ì´ ì§ì ‘ ì°¸ì¡°ê°€ ê°€ëŠ¥í•´ì§„ë‹¤ê³  í•œë‹¤.

<br />

```js
// lib.js
export function foo() {}
export function bar() {}

// main.js
import { foo } from './lib.js'
console.log(foo())
```

<br />

```js
function foo() {}

console.log(foo())
```

<br />

ê·¸ë˜ì„œ ë²ˆë“¤ ê³¼ì •ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì½”ë“œë¥¼ ì†ì‰½ê²Œ ì œê±°í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

<br />

### Next.jsì—ì„œ íŠ¸ë¦¬ì‰ì´í‚¹ ì ìš©

í”„ë¡œì íŠ¸ì˜ ê²½ìš° `Next.js`ë¥¼ í™œìš©í•˜ê³  ìˆë‹¤.

`Next.js`ì—ì„œëŠ” `optimizePackageImports`ë¥¼ í†µí•´ íŠ¹ì • íŒ¨í‚¤ì§€ë“¤ì˜ `import`ë¥¼ ìë™ìœ¼ë¡œ ìµœì í™”í•œë‹¤.

<br />

ì—¬ê¸°ì„œ `lodash-es`ëŠ” ìµœì í™” ëŒ€ìƒ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ í•˜ë‚˜ë¡œ,

ë³„ë„ì˜ ì„¤ì • ì—†ì´ë„ íŠ¸ë¦¬ì‰ì´í‚¹ì´ íš¨ê³¼ì ìœ¼ë¡œ ë™ì‘í•œë‹¤.

([ê¸°ë³¸ ìµœì í™” ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª©ë¡](https://nextjs.org/docs/pages/api-reference/config/next-config-js/optimizePackageImports))

<br />

## lodashì™€ lodash-es ë¹„êµ

ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” **ëª¨ë“ˆ í¬ë§·ì´ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒ**ì´ ê°€ì¥ í° ì°¨ì´ì ì´ë‹¤.

ë¼ì´ë¸ŒëŸ¬ë¦¬ êµì²´ì— ì•ì„œ ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¹„êµí•´ë³´ì.

### lodash

- ë‹¨ì¼ íŒŒì¼ë¡œ íŒ¨í‚¤ì§•
- ëª¨ë“ˆ ì‹œìŠ¤í…œì— ëŒ€í•œ ê±±ì •ì—†ì´ í”„ë¡œì íŠ¸ì— ì‰½ê²Œ í¬í•¨
- `CommonJS`, `AMD`ì™€ ëª¨ë‘ í˜¸í™˜ë˜ì–´ ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ í­ë„“ê²Œ ì‚¬ìš©

  <Image
    src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/bundle-phobia-lodash.png"
    alt="Bundlephobia lodash ì§€í‘œ"
  />

([Bundlephobia ê¸°ì¤€ lodash ì§€í‘œ](https://bundlephobia.com/package/lodash@4.17.21))

<br />

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/import-lodash.png"
  alt="import lodash"
/>

(import ì‹œ íŒŒì•…ë˜ëŠ” `lodash` ì§€í‘œ)

<br />

### lodash-es

- `ES Modules`ë¡œ ì„¤ê³„
- ë¹Œë“œ ê³¼ì •ì—ì„œ ë³´ë‹¤ íš¨ìœ¨ì ì¸ íŠ¸ë¦¬ì‰ì´í‚¹ ê°€ëŠ¥
- ì„í¬íŠ¸í•˜ëŠ” í•¨ìˆ˜ë§Œ ìµœì¢… ë²ˆë“¤ì— í¬í•¨

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/bundle-phobia-lodash-es.png"
  alt="Bundlephobia lodash-es ì§€í‘œ"
/>

([Bundlephobia ê¸°ì¤€ lodash-es ì§€í‘œ](https://bundlephobia.com/package/lodash-es@4.17.21))

<br />

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/import-lodash-es.png"
  alt="import lodash-es"
/>

(import ì‹œ íŒŒì•…ë˜ëŠ” `lodash-es` ì§€í‘œ)

<br />

## ì ìš©í•˜ê¸°

```bash
npm uninstall lodash
npm install lodash-es
npm install -D @types/lodash-es
```

<br />

`lodash-es`ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

```ts
import { í•¨ìˆ˜ } from 'lodash-es'
```

<br />

## AS-IS / TO-BE

### Bundle Analyzer ê¸°ì¤€

<div style={{ display: 'flex', justifyContent: 'center', gap: '10px' }}>
  <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
    <span>lodash</span>
    <Image
      src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/bundle-analyzer-lodash.png"
      alt="Bundle Analyzer lodash ì§€í‘œ"
    />
  </div>

  <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
    <span>lodash-es</span>
    <Image
      src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/bundle-analyzer-lodash-es.png"
      alt="Bundle Analyzer lodash-es ì§€í‘œ"
    />
  </div>
</div>

- `Stat size` ê¸°ì¤€ 562.28 KB â†’ 4.98 KB ê°œì„ 
- `Parsed size` ê¸°ì¤€ 86.31 KB â†’ 1.16 KB ê°œì„ 
- `GZipped size` ê¸°ì¤€ 27.88 KB â†’ 492 B ê°œì„ 

<br />

### next build ê¸°ì¤€

<div style={{ display: 'flex', justifyContent: 'center', gap: '10px' }}>
  <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
    <span>lodash</span>
    <Image
      src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/next-build-lodash.png"
      alt="Next Build lodash ì§€í‘œ"
    />
  </div>

  <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
    <span>lodash-es</span>
    <Image
      src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/next-build-lodash-es.png"
      alt="Next Build lodash-es ì§€í‘œ"
    />
  </div>
</div>

- `First Load JS shared by all` ê¸°ì¤€ 700KB â†’ 671KB ê°œì„  (29KB, 4% ê°ì†Œ)

<br />

### ë„¤íŠ¸ì›Œí¬ í™˜ê²½ ê¸°ì¤€

<div style={{ display: 'flex', justifyContent: 'center', gap: '10px' }}>
  <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
    <span>lodash</span>
    <Image
      src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/network-app-lodash.png"
      alt="ë„¤íŠ¸ì›Œí¬ _app lodash ì§€í‘œ"
    />
  </div>

  <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
    <span>lodash-es</span>
    <Image
      src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/lodash-tree-shaking/images/network-app-lodash-es.png"
      alt="ë„¤íŠ¸ì›Œí¬ _app lodash-es ì§€í‘œ"
    />
  </div>
</div>

- `JS` í¬ê¸° ê¸°ì¤€ 621KB â†’ 596KB ê°œì„  (26KB, 4% ê°ì†Œ)

<br />

ì—¬ëŸ¬ ì§€í‘œë“¤ì´ ê°œì„ ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

ì •ë§ ê°„ë‹¨í•œ ì‘ì—…ì´ì§€ë§Œ í° ê°œì„  íš¨ê³¼ë¥¼ ëˆ„ë¦´ ìˆ˜ ìˆë‹¤. ğŸ§

## ì°¸ê³  ë¬¸ì„œ

- [Webpack - Tree Shaking](https://webpack.js.org/guides/tree-shaking/)
- [Patterns - Tree Shaking](https://www.patterns.dev/vanilla/tree-shaking/)
- [íŠ¸ë¦¬ ì‰ì´í‚¹ìœ¼ë¡œ ìë°”ìŠ¤í¬ë¦½íŠ¸ í˜ì´ë¡œë“œ ì¤„ì´ê¸°](https://web.dev/articles/reduce-javascript-payloads-with-tree-shaking?hl=ko)
- [What is Tree Shaking and Why Would I Need It?](https://stackoverflow.com/questions/45884414/what-is-tree-shaking-and-why-would-i-need-it)
- [Static module structure](https://exploringjs.com/es6/ch_modules.html#static-module-structure)
- [Optimizing package imports](https://nextjs.org/docs/pages/building-your-application/optimizing/package-bundling#optimizing-package-imports)
- [How we optimized package imports in Next.js](https://vercel.com/blog/how-we-optimized-package-imports-in-next-js)
- [lodash vs lodash-es](https://npm-compare.com/lodash,lodash-es)
