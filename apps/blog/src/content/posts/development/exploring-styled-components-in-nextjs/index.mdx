---
title: 'Next.jsì—ì„œì˜ styled-components íƒêµ¬'
description: 'Next.jsì—ì„œ styled-componentsì„ í™œìš©í•˜ëŠ” ê³¼ì •ì„ ë¶„ì„í•©ë‹ˆë‹¤.'
date: '2024-07-04'
thumbnail: './images/exploring-styled-components-in-nextjs-thumbnail.png'
thumbnail_alt: 'Exploring styled-components in next.js thumbnail'
category: 'development'
---

<Callout>
  ğŸ’¡ Next.jsì—ì„œ styled-componentsì„ í™œìš©í•˜ëŠ” ê³¼ì •ì„ ë¶„ì„í•©ë‹ˆë‹¤. í”¼ë“œë°±ì€ ì–¸ì œë‚˜
  í™˜ì˜ì…ë‹ˆë‹¤:)
</Callout>

> í•´ë‹¹ ê¸€ì˜ ë²„ì „ì€ Next.js v14(Page Router), styled-components v6ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.

<br />

í”„ë¡œì íŠ¸ì—ì„œ `Next.js`ì™€ `styled-omponents`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

ê·¼ë° `Next.js`ë¥¼ ì‚¬ìš©í•  ë•Œ `CSS-in-JS`ì„ ì“°ë©´ ë¬¸ì œê°€ ë§ë‹¤ëŠ” ê²ƒì„ ë“£ê¸°ë§Œ í–ˆì§€ ìì„¸íˆ ì‚´í´ë³´ì§€ëŠ” ì•Šì•˜ì—ˆë‹¤.

ì´ë²ˆ ê¸°íšŒì— í•œ ë²ˆ ì•Œì•„ë³´ê³ ì í•œë‹¤. ğŸ§

## ë¬¸ì œ ì ‘ê·¼í•˜ê¸°

ê¸°ë³¸ í™˜ê²½ ì„¸íŒ…ì€ `npx create-next-app@latest`ìœ¼ë¡œ ì§„í–‰í–ˆë‹¤.

<br />

ì˜ˆì œ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

**pages/index.tsx**

```tsx
import styled from 'styled-components'

export default function Home() {
  return (
    <>
      <Container>
        <Title>í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</Title>
        <Button>Click Me!</Button>
      </Container>
    </>
  )
}

const Container = styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  background-color: #e0ffe0;
`

const Title = styled.h1`
  font-size: 2.5em;
  color: #008000;
`

const Button = styled.button`
  background-color: #008000;
  color: white;
  border: none;
  padding: 10px 20px;
  font-size: 1em;
  cursor: pointer;
  border-radius: 5px;
  margin-top: 20px;
`
```

<br />

ìš°ì„  `next.config.js`ì—ì„œ `styledComponents: true`ë¡œ ì„¤ì •í•œë‹¤.

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  compiler: { styledComponents: true },
}

export default nextConfig
```

<br />

ì´ê±°ë§Œ í•´ë„ í™”ë©´ì—ì„œëŠ” ì œëŒ€ë¡œ ìŠ¤íƒ€ì¼ì´ ì ìš©ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

<div style={{ display: 'flex', justifyContent: 'center' }}>
  <Image
    src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/exploring-styled-components-in-nextjs/images/sc-example.png"
    alt="sc example"
  />
</div>

<br />

í•˜ì§€ë§Œ í˜„ì¬ ìƒí™©ì€ í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ìŠ¤íƒ€ì¼ì„ ë°›ì•„ì˜¤ëŠ” ìƒí™©ì´ë‹¤.

`styled-components`ëŠ” `CSS-in-JS` ë°©ì‹ìœ¼ë¡œ `JavaScript`ë¥¼ í†µí•´ ìŠ¤íƒ€ì¼ì„ êµ¬ì„±ëœë‹¤. (ì¼ë°˜ `CSS`ë¡œ ì§ë ¬í™”í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.)

ì˜ˆì œ ì½”ë“œì—ì„œ ì‚¬ìš©ëœ `#00800`ì„ ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ ê²€ìƒ‰í•˜ë©´ `index.js` ë²ˆë“¤ì— í¬í•¨ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<br />

**index.js ë²ˆë“¤ì— ìŠ¤íƒ€ì¼ì´ í¬í•¨ëœ ëª¨ìŠµ**

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/exploring-styled-components-in-nextjs/images/index-bundle.png"
  alt="index.js bundle"
/>

<br />

ë”°ë¼ì„œ ì§€ê¸ˆê³¼ ê°™ì€ ìƒí™©ì—ì„œ `styled-components`ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ìŠ¤íƒ€ì¼ì„ ë°›ì•„ì˜¤ê²Œ ëœë‹¤.

í•˜ì§€ë§Œ `Next.js`ì™€ ê°™ì´ ë¯¸ë¦¬ ì„œë²„ì—ì„œ ë Œë”ë§ì´ ì¼ì–´ë‚˜ëŠ” ê²½ìš° **ê¹œë¹¡ì´ëŠ” ë¬¸ì œì™€ ìŠ¤íƒ€ì¼ì´ ì ìš©ë˜ì§€ ì•Šì€ ë¬¸ì„œ**ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.

<br />

**ê¹œë¹¡ì´ëŠ” ë¬¸ì œ**

<Video
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/exploring-styled-components-in-nextjs/videos/sc-problem-1.mov"
  alt="ê¹œë¹¡ì´ëŠ” ë¬¸ì œ"
/>

<br />

**ìŠ¤íƒ€ì¼ì´ ì ìš©ë˜ì§€ ì•Šì€ ë¬¸ì„œ**

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/exploring-styled-components-in-nextjs/images/sc-problem-2.png"
  alt="ìŠ¤íƒ€ì¼ì´ ì ìš©ë˜ì§€ ì•Šì€ ë¬¸ì„œ"
/>

## ë¬¸ì œ í•´ê²°í•˜ê¸°

ê°ì‚¬í•˜ê²Œë„ ê´€ë ¨ [ì˜ˆì œ](https://github.com/vercel/next.js/tree/canary/examples/with-styled-components)ë¥¼ ì œê³µí•´ì£¼ê³  ìˆë‹¤.

**pages/\_documents.tsx**

```tsx
import Document, { DocumentContext, DocumentInitialProps } from 'next/document'
import { ServerStyleSheet } from 'styled-components'

export default class MyDocument extends Document {
  static async getInitialProps(ctx: DocumentContext): Promise<DocumentInitialProps> {
    const sheet = new ServerStyleSheet()
    const originalRenderPage = ctx.renderPage

    try {
      ctx.renderPage = () =>
        originalRenderPage({
          enhanceApp: (App) => (props) => sheet.collectStyles(<App {...props} />),
        })

      const initialProps = await Document.getInitialProps(ctx)
      return {
        ...initialProps,
        styles: [initialProps.styles, sheet.getStyleElement()],
      }
    } finally {
      sheet.seal()
    }
  }
}
```

<br />

ì„¸ë¶€ì ì¸ ë‚´ìš©ì€ ë‚˜ì¤‘ì— ì‚´í´ë³´ê³  ê²°ê³¼ë¶€í„° ë³´ë©´ ê¸°ëŒ€í•˜ëŠ” ë°”ì™€ ì¼ì¹˜í•œë‹¤.

<br />

ë” ì´ìƒ ê¹œë¹¡ê±°ë¦¬ì§€ ì•ŠëŠ”ë‹¤.

<Video
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/exploring-styled-components-in-nextjs/videos/sc-solution-1.mov"
  alt="sc í•´ê²° 1"
/>

<br />

ì²˜ìŒ ë¬¸ì„œì—ë„ ìŠ¤íƒ€ì¼ì´ ì ìš©ëœ ìƒíƒœë¡œ ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/exploring-styled-components-in-nextjs/images/sc-solution-2.png"
  alt="sc í•´ê²° 2"
/>

<br />

## styled-componentsëŠ” ì–´ë–»ê²Œ í•´ê²°í–ˆì„ê¹Œ?

`_documents.tsx` ì½”ë“œë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ì.

í¬ê²Œ 3ê°€ì§€ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

<br />

ìš°ì„  ì„œë²„ ì‹œíŠ¸ë¥¼ ìƒì„±í•œë‹¤.

```tsx
const sheet = new ServerStyleSheet()
```

<br />

í•´ë‹¹ ë¡œì§ì—ì„œëŠ” `sheet.collectStyles`ì„ í†µí•´ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‘ì„±í–ˆë˜ ìŠ¤íƒ€ì¼ë“¤ì„ ìˆ˜ì§‘í•œë‹¤.

```tsx
// Next.jsì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ í˜ì´ì§€ ë Œë”ë§ ë©”ì„œë“œ
ctx.renderPage = () =>
  // Next.js ê¸°ë³¸ ë Œë”ë§ ë¡œì§ì„ ì°¸ì¡°í•˜ëŠ” ë³€ìˆ˜
  originalRenderPage({
    // Next.js ì „ì²´ react tree(App ì»´í¬ë„ŒíŠ¸)ë¥¼ ê°ì‹¸ê¸° ìœ„í•œ ê³ ì°¨ ì»´í¬ë„ŒíŠ¸(HOC)
    enhanceApp: (App) => (props) => sheet.collectStyles(<App {...props} />), // ìŠ¤íƒ€ì¼ ìˆ˜ì§‘
  })
```

<br />

`html`ì— ìŠ¤íƒ€ì¼ íƒœê·¸ë¥¼ ì¶”ê°€í•œë‹¤.

ì—¬ê¸°ì„œ `sheet.getStyleElement`ì„ í†µí•´ ìˆ˜ì§‘í–ˆë˜ ìŠ¤íƒ€ì¼ì„ `React` `Element`ë¡œ ë°˜í™˜í•˜ê²Œ í•´ì¤€ë‹¤.

```tsx
return {
  ...initialProps,
  styles: [initialProps.styles, sheet.getStyleElement()], // ìˆ˜ì§‘ëœ ìŠ¤íƒ€ì¼ì„ React Elementë¡œ ë°˜í™˜
}
```

<br />

**ì¶”ê°€ëœ ìŠ¤íƒ€ì¼ íƒœê·¸**

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/exploring-styled-components-in-nextjs/images/add-style-tag.png"
  alt="ì¶”ê°€ëœ ìŠ¤íƒ€ì¼ íƒœê·¸"
/>

### styled-components ì½”ë“œ ì‚´í´ë³´ê¸°

ë™ì‘ì„ ì¢€ ë” ì´í•´í•´ë³´ì.

[ServerStyleSheet ì½”ë“œ](https://github.com/styled-components/styled-components/blob/770d1fa2bc1a4bfe3eea1b14a0357671ba9407a4/packages/styled-components/src/models/ServerStyleSheet.tsx)

<br />

ì‹œì‘ì ì¸ `ServerStyleSheet`ì„ í†µí•´ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì•ì„œ ì‚´í´ë³¸ 2ê°€ì§€ ë™ì‘ì´ ë°œìƒí•œë‹¤.

- `collectStyles`: ìŠ¤íƒ€ì¼ ìˆ˜ì§‘
- `getStyleElement`:ìˆ˜ì§‘ëœ ìŠ¤íƒ€ì¼ì„ `React` `Element`ë¡œ ë°˜í™˜

<br />

`collectStyles`ì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

[collectStyles ì½”ë“œ](https://github.com/styled-components/styled-components/blob/770d1fa2bc1a4bfe3eea1b14a0357671ba9407a4/packages/styled-components/src/models/ServerStyleSheet.tsx#L37-L43)

<br />

**collectStyles**

```tsx
collectStyles(children: any): JSX.Element {
  if (this.sealed) {
    throw styledError(2);
  }

  return <StyleSheetManager sheet={this.instance}>{children}</StyleSheetManager>;
}
```

<br />

`StyleSheetManager`ê°€ ë“±ì¥í•œë‹¤.

[StyleSheetManager ì½”ë“œ](https://github.com/styled-components/styled-components/blob/770d1fa2bc1a4bfe3eea1b14a0357671ba9407a4/packages/styled-components/src/models/StyleSheetManager.tsx)

<br />

**StyleSheetManager**

```tsx
export function StyleSheetManager(props: IStyleSheetManager): JSX.Element {
  const [plugins, setPlugins] = useState(props.stylisPlugins);
  const { styleSheet } = useStyleSheetContext();

  const resolvedStyleSheet = ìŠ¤íƒ€ì¼ ì‹œíŠ¸ë¥¼ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜

  const stylis = ìŠ¤íƒ€ì¼ ì½”ë“œë¡œ ë§Œë“¤ì–´ì£¼ëŠ” í•¨ìˆ˜

  ...

  const styleSheetContextValue = useMemo(
    () => ({
      shouldForwardProp: props.shouldForwardProp,
      styleSheet: resolvedStyleSheet,
      stylis,
    }),
    [props.shouldForwardProp, resolvedStyleSheet, stylis]
  );

  return (
    <StyleSheetContext.Provider value={styleSheetContextValue}>
      <StylisContext.Provider value={stylis}>{props.children}</StylisContext.Provider>
    </StyleSheetContext.Provider>
  );
}
```

í•´ë‹¹ ì»¨í…ìŠ¤íŠ¸ë¥¼ í†µí•´ ìŠ¤íƒ€ì¼ì„ ìˆ˜ì§‘ ë° ë³€í™˜í•´ì„œ `StyleSheetManager`ì—ì„œ ì£¼ì…í•œ `sheet`ì— ë°˜ì˜ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒëœë‹¤.

<br />

ë‹¤ìŒìœ¼ë¡œ `getStyleElement` ì½”ë“œì´ë‹¤.

[getStyleElement ì½”ë“œ](https://github.com/styled-components/styled-components/blob/770d1fa2bc1a4bfe3eea1b14a0357671ba9407a4/packages/styled-components/src/models/ServerStyleSheet.tsx#L53-L73)

<br />

**getStyleElement**

```tsx
getStyleElement = () => {
  if (this.sealed) {
    throw styledError(2)
  }

  const props = {
    [SC_ATTR]: '',
    [SC_ATTR_VERSION]: SC_VERSION,
    dangerouslySetInnerHTML: {
      __html: this.instance.toString(),
    },
  }

  const nonce = getNonce()
  if (nonce) {
    ;(props as any).nonce = nonce
  }

  // v4 returned an array for this fn, so we'll do the same for v5 for backward compat
  return [<style {...props} key="sc-0-0" />]
}
```

`dangerouslySetInnerHTML`ê°€ ëˆˆì— ëˆë‹¤.

`this.instance.toString()`ì„ í†µí•´ ì•ì„œ ì‹œíŠ¸ì— ìˆ˜ì§‘í•œ ìŠ¤íƒ€ì¼ë“¤ì„ ë¬¸ìì—´ë¡œ ë°˜í™˜í•œë‹¤.

ê·¸ ë‹¤ìŒ `dangerouslySetInnerHTML`ì„ í†µí•´ `DOM`ì— ì£¼ì…í•˜ëŠ”ë° `style` íƒœê·¸ì— ë°˜í™˜í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

## ë§ˆë¬´ë¦¬

ì´ì „ê¹Œì§€ëŠ” ì„œë²„ ë Œë”ë§ì´ ì´ë£¨ì–´ì§ˆ ë•Œ `CSS-in-JS`ê°€ ë¬¸ì œê°€ ë§ë‹¤ê³  ë“£ê¸°ë§Œ í–ˆì§€ ê¹Šê²Œ íŒŒê³ ë“¤ì§€ëŠ” ëª»í–ˆë‹¤.

ì´ë²ˆ ê¸°íšŒì— ì§ì ‘ ì½”ë“œë¥¼ êµ¬ì„±í•´ë³´ë©´ì„œ ì–´ë– í•œ ê²½ìš°ì— ë¬¸ì œê°€ ë°œìƒí•˜ê³  ì–´ë–»ê²Œ í•´ê²°í•˜ëŠ”ì§€ ì•Œê²Œ ë˜ì—ˆë‹¤.

ê·¸ë¦¬ê³  ì§ì ‘ `styled-components` ì½”ë“œë„ ì‚´í´ë³´ë©´ì„œ í¥ë¯¸ë¡­ê²Œ í•™ìŠµí•œ ì‹œê°„ì´ ë˜ì—ˆë˜ ê²ƒ ê°™ë‹¤.

## ì°¸ê³  ë¬¸ì„œ

- [styled-components(Advanced Usage - server-side-rendering)](https://styled-components.com/docs/advanced#server-side-rendering)
- [Example app with styled-components](https://github.com/vercel/next.js/tree/canary/examples/with-styled-components)
