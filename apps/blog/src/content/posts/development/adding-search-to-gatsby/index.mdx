---
title: 'Gatsby - ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°'
description: 'Gatsbyì—ì„œ ê²€ìƒ‰ ê¸°ëŠ¥ì„ êµ¬í˜„í•œ ê³¼ì •ì„ ì •ë¦¬í•©ë‹ˆë‹¤.'
date: '2023-03-29'
thumbnail: './images/gatsby-thumbnail.png'
thumbnail_alt: 'gatsby-thumbnail'
category: 'development'
---

<Callout>
  ğŸ’¡ Gatsbyì—ì„œ ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„ê³¼ ë¦¬íŒ©í† ë§ ê³¼ì •ì„ ë‚¨ê¸°ê³ ì í•©ë‹ˆë‹¤. í”¼ë“œë°±ì€ ì–¸ì œë‚˜
  í™˜ì˜ì…ë‹ˆë‹¤:)
</Callout>

## ê²€ìƒ‰ ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°

ë¸”ë¡œê·¸ì— ê¸€ì´ ë§ì•„ì§ˆ ê²½ìš° ì›í•˜ëŠ” ê²Œì‹œë¬¼ì„ ì°¾ê¸° í˜ë“¤ì–´ì§ˆ ê²ƒì…ë‹ˆë‹¤.
ì´ì— ê²€ìƒ‰ ê¸°ëŠ¥ì€ ë¸”ë¡œê·¸ì— ìˆì–´ì„œ í•„ìˆ˜ì ì´ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.
ê·¸ë˜ì„œ Gastbyì—ì„œ ì–´ë–»ê²Œ í•˜ë©´ ê²€ìƒ‰ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆì„ì§€ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤.

ê²€ìƒ‰ ê¸°ëŠ¥ê³¼ ê´€ë ¨í•˜ì—¬ Gatsby ê³µì‹ ë¬¸ì„œ [Adding Search](https://www.gatsbyjs.com/docs/how-to/adding-common-features/adding-search/)ì—ì„œ ì œì•ˆí•˜ëŠ” ë°©ì‹ì´ ìˆìŠµë‹ˆë‹¤.
Client-side serachì—ì„œì˜ `js-search`, API-based search engineì—ì„œì˜ `Algolia`, `Meilisearch`, `Typesense` ë“±ì„ ì œì•ˆí•©ë‹ˆë‹¤.

ìš°ì„ , ì €ì˜ ìƒí™©ì„ ê³ ë ¤í–ˆì„ ë•Œ ê²€ìƒ‰ ê¸°ëŠ¥ì€ ì²˜ìŒ êµ¬í˜„í•´ë³´ëŠ” ê¸°ëŠ¥ì´ì–´ì„œ API-based search engine ë°©ì‹ì€ ë¹ ë¥´ê²Œ ë„ì…í•˜ê¸° ì–´ë ¤ìš¸ ê²ƒì´ë¼ëŠ” íŒë‹¨ì„ í–ˆìŠµë‹ˆë‹¤.
ê·¸ë˜ì„œ Client-side searchë¡œ ë°©í–¥ì„ ì¡ê³  ë‹¤ë¥¸ ì‚¬ëŒë“¤ì€ ì–´ë–»ê²Œ êµ¬í˜„í–ˆë‚˜ ì‚´í´ë´¤ìŠµë‹ˆë‹¤.

ë‹¤í–‰íˆë„ `js-search`ë³´ë‹¤ ë” ì‰½ê²Œ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ë„ì™€ì£¼ëŠ” í”ŒëŸ¬ê·¸ì¸ì´ ì¡´ì¬í–ˆìŠµë‹ˆë‹¤.
[gatsby-plugin-fusejs](https://www.gatsbyjs.com/plugins/gatsby-plugin-fusejs/?=fusejs)ì„ ì‚¬ìš©í•˜ë©´ ì‰½ê³  ë¹ ë¥´ê²Œ ê²€ìƒ‰ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### gatsby-plugin-fusejs ì„¤ì •í•˜ê¸°

ìš°ì„  í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
yarn add gatsby-plugin-fusejs
```

gatsby-config íŒŒì¼ì—ì„œ ê´€ë ¨ëœ ì„¤ì •ì„ í•´ì¤ë‹ˆë‹¤.

```js
{
  resolve: 'gatsby-plugin-fusejs',
  options: {
    query: `
      {
        allMdx {
          nodes {
            id
            frontmatter {
              title
              date
              slug
              category
            }
            excerpt
          }
        }
      }
    `,
    keys: ['frontmatter.title', 'excerpt'],
    normalizer: ({ data }) =>
      data.allMdx.nodes.map((node) => ({
        id: node.id,
        frontmatter: {
          title: node.frontmatter.title,
          slug: node.frontmatter.slug,
          date: node.frontmatter.date,
          category: node.frontmatter.category,
        },
        excerpt: node.excerpt,
      })),
  },
},
```

ì½”ë“œë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```js
query: `
  {
    allMdx {
      nodes {
        id
        frontmatter {
          title
          date
          slug
          category
        }
        excerpt
      }
    }
  }
`,
```

queryì—ì„œëŠ” ë§Œë“¤ê³ ì í•˜ëŠ” ë°ì´í„°ë¥¼ ë°›ìŠµë‹ˆë‹¤.

```js
keys: ['frontmatter.title', 'excerpt'],
```

keysì—ì„œëŠ” ê²€ìƒ‰ì— ì‚¬ìš©í•  ë¶€ë¶„ì„ ì¸ë±ìŠ¤ë¡œ ì •í•©ë‹ˆë‹¤.
[Fuse.createIndex](https://fusejs.io/api/indexing.html#fuse-createindex)

ì €ëŠ” ì œëª©ì¸ **title**ê³¼ ê²Œì‹œë¬¼ë³„ë¡œ ë¯¸ë¦¬ë³¼ ìˆ˜ ìˆëŠ” í…ìŠ¤íŠ¸ì¸ **excerpt**ë¡œ ì •í–ˆìŠµë‹ˆë‹¤.

```js
normalizer: ({ data }: any) =>
  data.allMdx.nodes.map((node: any) => ({
    id: node.id,
    frontmatter: {
      title: node.frontmatter.title,
      slug: node.frontmatter.slug,
      date: node.frontmatter.date,
      category: node.frontmatter.category,
    },
    excerpt: node.excerpt,
  })),
```

`normalizer`ëŠ” ì¿¼ë¦¬ì—ì„œ ë°˜í™˜ëœ ë°ì´í„°ë¥¼ ì •ê·œí™”í•˜ëŠ” í•¨ìˆ˜ë¼ê³  ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
GraphQLì˜ ê²°ê³¼ë¬¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/adding-search-to-gatsby/images/graphql-allfusejs-data.png"
  alt="graphql-allfusejs-data"
/>

indexì—ëŠ” ì•ì„œ keysì— ë„£ì—ˆë˜ ë°ì´í„°ë“¤ì´ ê²€ìƒ‰ìœ¼ë¡œ í™œìš©ë  ìˆ˜ ìˆë„ë¡ ë³€í˜•ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/adding-search-to-gatsby/images/graphql-allfusejs-index.png"
  alt="graphql-allfusejs-index"
/>

### Gatsbyì—ì„œ fuse.js ì ìš©í•˜ê¸°

gatsby-plugin-fusejsì—ì„œëŠ” **react-use-fusejs**ì™€ í•¨ê»˜ ì‚¬ìš©í•  ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ ì €ì˜ ê²½ìš° react-use-fusejsì™€ í•¨ê»˜ ì‚¬ìš©í•  ì‹œ ì—ëŸ¬ê°€ ë°œìƒí•˜ë”ë¼êµ¬ìš”.ğŸ˜‚

ê·¸ë˜ì„œ react-use-fusejs [ë‚´ë¶€ ì½”ë“œ](https://github.com/johnny-mh/blog2/blob/main/packages/react-use-fusejs/src/index.ts)ë¥¼ ì°¾ì•„ë´¤ìŠµë‹ˆë‹¤.
ë‚´ë¶€ ì½”ë“œë¥¼ ì‚´í´ë´¤ì„ ë•Œ `useGatsbyPluginFusejs` í•¨ìˆ˜ë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê°™ì•˜ìŠµë‹ˆë‹¤.
ì´ ì •ë„ë©´ ì œê°€ ì»¤ìŠ¤í…€í•´ì„œ ì‚¬ìš©í•´ë„ ê´œì°®ê² ë‹¤ëŠ” ìƒê°ì„ í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

```tsx
export function useGatsbyPluginFusejs<T>(
  query: string,
  fusejs: { data: T[]; index: string },
  fuseOpts?: Fuse.IFuseOptions<T>,
  parseOpts?: Fuse.FuseIndexOptions<T>,
  searchOpts?: Fuse.FuseSearchOptions,
) {
  const [instance, setInstance] = useState<null | Fuse<T>>(null)

  useEffect(() => {
    if (!fusejs?.data || !fusejs?.index) {
      setInstance(null)
      return
    }

    const inst = new Fuse<T>(
      fusejs.data,
      fuseOpts,
      Fuse.parseIndex(JSON.parse(fusejs.index), parseOpts),
    )

    setInstance(inst)
  }, [fusejs])

  return useMemo(() => {
    if (!query || !instance) {
      return []
    }

    return instance?.search(query, searchOpts) || []
  }, [query, instance])
}
```

ì—¬ê¸°ì„œ ì œê°€ í•„ìš”í•œ ë¶€ë¶„ë§Œ ê³¨ë¼ì„œ ì‚¬ìš©í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ì½”ë“œë¥¼ í•˜ë‚˜ì”© ì‚´í´ë´¤ì„ ë•Œ `new Fuse`ì—ì„œ ë§Œë“  ë°ì´í„°ê°€ `search` ë©”ì„œë“œë¥¼ í†µí•´ ê²€ìƒ‰ ê²°ê³¼ë¡œ ë³€í™˜ë˜ëŠ” ê²ƒ ê°™ë„¤ìš”.

[Fuse.parseIndex](https://fusejs.io/api/indexing.html#fuse-parseindex)ëŠ” ë¬¸ì„œì™€ ì½”ë“œì˜ íë¦„ì„ ë´¤ì„ ë•Œ GraphQLì—ì„œ ë§Œë“¤ì—ˆë˜ indexë¡œ ë³´ì…ë‹ˆë‹¤.

ì–´ë– í•œ íë¦„ì¸ì§€ íŒŒì•…í–ˆìœ¼ë‹ˆ ì´ ë¶€ë¶„ì„ ì €ì—ê²Œ ë§ê²Œ ì‘ì—…í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´ [fuse.js](https://fusejs.io/)ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
yarn add fuse.js
```

**useSearch.ts**

```ts
import Fuse from 'fuse.js'
import { useMemo } from 'react'

export default function useSearch<T>(
  query: string,
  fusejs: { data: T[]; index: string },
) {
  const fuse = useMemo(() => {
    return new Fuse()<T>(
      fusejs.data,
      undefined,
      Fuse.parseIndex(JSON.parse(fusejs.index)),
    )
  }, [fusejs])

  return fuse.search(query)
}
```

í•´ë‹¹ í›…ì€ ì •ë§ ê°„ì†Œí™”í•œ ë²„ì „ì„ì„ ì°¸ê³ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.ğŸ˜…

ì´ë ‡ê²Œ ë§Œë“  í›…ì„ ê²€ìƒ‰ í˜ì´ì§€ì— ì‚¬ìš©í•˜ë©´ ë˜ê² ìŠµë‹ˆë‹¤.

**search.tsx**

```tsx
import styled from '@emotion/styled'
import App from 'App'
import { Layout, Post, PostList } from 'components'
import { Flex } from 'components/@shared'
import { graphql, useStaticQuery } from 'gatsby'
import useIntersectionObserver from 'hooks/useIntersectionObserver'
import useSearch from 'hooks/useSearch'
import React, { useState } from 'react'
import { Content } from 'types/content'

interface searchPost {
  fusejs: {
    index: string
    data: Content[]
  }
}

const Search = () => {
  const search: searchPost = useStaticQuery(graphql`
    {
      fusejs {
        index
        data
      }
    }
  `)
  const [query, setQuery] = useState('')
  const nodes = useSearch(query, search.fusejs)
  const { ref, page } = useIntersectionObserver(nodes.length)

  return (
    <App>
      <Layout>
        <Flex flexDirection="column" gap={20}>
          <Input
            placeholder="Search"
            value={query}
            onChange={(e) => setQuery(e.currentTarget.value)}
          />

          {query !== '' && (
            <span>
              &apos;<strong>{query}</strong>&apos; ê²€ìƒ‰ ê²°ê³¼ ({nodes.length}ê°œ)
            </span>
          )}

          <PostList
            render={nodes.slice(0, page).map((node) => (
              <Post key={node.refIndex} node={node.item} />
            ))}
          />
          <div ref={ref} />
        </Flex>
      </Layout>
    </App>
  )
}

export default Search

const Input = styled.input`
  border-radius: 10px;
  width: 100%;
  padding: 10px 20px;
  border: 3px solid ${({ theme }) => theme.colors.secondary.light};

  &:focus {
    outline: none;
  }
`
```

## ë§ˆë¬´ë¦¬

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/contents/development/adding-search-to-gatsby/images/search.gif"
  alt="search"
/>

í”ŒëŸ¬ê·¸ì¸ì˜ ë„ì›€ì„ í†µí•´ ê²€ìƒ‰ ê¸°ëŠ¥ë„ ì‰½ê³  ë¹ ë¥´ê²Œ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
í•´ë‹¹ ê³¼ì •ì—ì„œëŠ” í”ŒëŸ¬ê·¸ì¸ ë‚´ë¶€ì˜ ì½”ë“œë„ ì‚´í´ë³´ë©° ì»¤ìŠ¤í„°ë§ˆì´ì§•í•˜ëŠ” ê³¼ì •ì„ ê±°ì³¤ìŠµë‹ˆë‹¤. ë‹¤í–‰íˆ ì„±ê³µì ìœ¼ë¡œ êµ¬í˜„í•˜ì—¬ ë§Œì¡±ìŠ¤ëŸ½ë„¤ìš”.

ì´ë²ˆ ê¸€ì„ í†µí•´ Gatsbyì—ì„œ ê²€ìƒ‰ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë ¤ëŠ” ë¶„ë“¤ì—ê²Œ ë„ì›€ì´ ë˜ì—ˆìœ¼ë©´ í•©ë‹ˆë‹¤.ğŸ™‡â€â™‚ï¸
