---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { useTranslations } from '../../i18n';

const locale = 'ko';
const t = useTranslations(locale);

const roads = (await getCollection('roads'))
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

// Group by year
const byYear = roads.reduce<Record<string, typeof roads>>((acc, road) => {
  const year = road.data.date.slice(0, 4);
  if (!acc[year]) acc[year] = [];
  acc[year].push(road);
  return acc;
}, {});

const years = Object.keys(byYear).sort((a, b) => Number(b) - Number(a));

function getSlug(id: string) {
  // id: 2025/03/23 → slug: 2025-03-23
  return id.replace(/\//g, '-').replace(/\.mdx?$/, '');
}
---

<BaseLayout title="기록" description={t.road.description}>
  <section>
    <h1 class="text-2xl font-bold mb-2">{t.nav.road}</h1>
    <p class="text-muted text-sm mb-8">{t.road.description}</p>

    <div class="space-y-10">
      {years.map((year) => (
        <div>
          <h2 class="text-sm font-semibold text-muted mb-3">{year}</h2>
          <ul class="space-y-3">
            {byYear[year].map((road) => (
              <li>
                <a href={`/road/${getSlug(road.id)}`} class="group flex gap-4 items-baseline">
                  <span class="text-sm text-muted shrink-0 w-16">{road.data.date.slice(5)}</span>
                  <span class="text-sm group-hover:underline underline-offset-2 line-clamp-1">{road.data.title}</span>
                </a>
              </li>
            ))}
          </ul>
        </div>
      ))}
    </div>
  </section>
</BaseLayout>
