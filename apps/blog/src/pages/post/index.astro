---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { useTranslations } from '../../i18n';

const locale = 'ko';
const t = useTranslations(locale);

const allPosts = (await getCollection('posts')).sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

const categories = ['all', 'development', 'study', 'reading', 'essay'] as const;

function getSlug(id: string) {
  return id.split('/').at(-1) ?? id;
}
---

<BaseLayout title="글">
  <section>
    <h1 class="text-2xl font-bold mb-8">{t.nav.post}</h1>

    <!-- Category filter (static render, JS-free filtering via URL) -->
    <div class="flex flex-wrap gap-2 mb-8">
      {categories.map((cat) => (
        <a
          href={cat === 'all' ? '/post' : `/post/category/${cat}`}
          class="px-3 py-1 text-sm border border-border rounded-full hover:bg-fg hover:text-bg transition-colors"
        >
          {t.post.category[cat]}
        </a>
      ))}
    </div>

    <ul class="space-y-6">
      {allPosts.map((post) => (
        <li class="border-b border-border pb-6 last:border-0">
          <a href={`/post/${getSlug(post.id)}`} class="group block">
            <p class="text-muted text-sm mb-1">
              {post.data.date} · {t.post.category[post.data.category]}
            </p>
            <h2 class="font-semibold group-hover:underline underline-offset-2">{post.data.title}</h2>
            <p class="text-sm text-muted mt-1 line-clamp-2">{post.data.description}</p>
          </a>
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>
