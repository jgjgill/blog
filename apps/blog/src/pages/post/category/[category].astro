---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { useTranslations } from '../../../i18n';

export async function getStaticPaths() {
  const categories = ['development', 'study', 'reading', 'essay'] as const;
  return categories.map((category) => ({ params: { category } }));
}

const { category } = Astro.params as { category: 'development' | 'study' | 'reading' | 'essay' };

const locale = 'ko';
const t = useTranslations(locale);

const posts = (await getCollection('posts'))
  .filter((p) => p.data.category === category)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

const allCategories = ['all', 'development', 'study', 'reading', 'essay'] as const;

function getSlug(id: string) {
  return id.split('/').at(-1) ?? id;
}
---

<BaseLayout title={`${t.post.category[category]} | ê¸€`}>
  <section>
    <h1 class="text-2xl font-bold mb-8">{t.nav.post}</h1>

    <div class="flex flex-wrap gap-2 mb-8">
      {allCategories.map((cat) => (
        <a
          href={cat === 'all' ? '/post' : `/post/category/${cat}`}
          class:list={[
            'px-3 py-1 text-sm border rounded-full transition-colors',
            cat === category
              ? 'bg-fg text-bg border-[var(--color-fg)]'
              : 'border-border hover:bg-fg hover:text-bg',
          ]}
        >
          {t.post.category[cat]}
        </a>
      ))}
    </div>

    <ul class="space-y-6">
      {posts.map((post) => (
        <li class="border-b border-border pb-6 last:border-0">
          <a href={`/post/${getSlug(post.id)}`} class="group block">
            <p class="text-muted text-sm mb-1">{post.data.date}</p>
            <h2 class="font-semibold group-hover:underline underline-offset-2">{post.data.title}</h2>
            <p class="text-sm text-muted mt-1 line-clamp-2">{post.data.description}</p>
          </a>
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>
