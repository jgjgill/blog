---
title: '[DEP0040] punycode module deprecated 경고 메시지와 해결 과정'
date: '2025-05-17'
slug: '2025-05-17'
type: 'road'
---

Node.js 환경에서 실행되는 CLI 도구를 만들던 도중 다음과 같은 경고 메시지를 보게 되었다.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/roads/images/punycode-warning.png"
  alt="punycode warning"
/>

<br />

```bash
(node:15937) [DEP0040] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
```

<br />

`npm ls punycode`를 입력하면 프로젝트 내에서 `punycode`가 사용되는 영역을 확인할 수 있다.

<Image
  src="https://raw.githubusercontent.com/jgjgill/blog/main/roads/images/npm-ls-punycode.png"
  alt="npm ls punycode"
/>

<br />

기능에는 문제가 없지만, 경고 메시지가 계속해서 출력되니 신경이 쓰이면서 불편함을 느끼게 되었다.

## node `22.14.0+` 버전 업데이트 해결하기

[관련 내용](https://github.com/vercel/next.js/discussions/66289)을 찾아보니 해당 경고는 node.js에서 `punycode` 모듈을 deprecated 처리하면서 발생하게 된 경고이다.

<br />

`punycode`는 URL 인코딩과 관련된 기능을 제공하는 모듈인데, Node.js `v22.0.0`부터 deprecated 처리되었다고 한다.
[이슈 작업 PR](https://github.com/nodejs/node/pull/56632)을 확인했을 때 node `22.14.0` 버전 이상부터 해당 메시지가 보이지 않게 처리되었다.

<br />

따라서 현재 문제 상황 자체는 `22.14.0` 버전 이상으로 업데이트하면서 해결했다.

## PR 논의 살펴보기

이슈 작업 PR에서의 논의 과정에서도 배울 점들이 많아서 좀 더 살펴보면서 정리했다.

### 핵심 내용

- **DEP0040 경고의 문제점**: Node.js에서 punycode 모듈이 deprecated 되었다는 경고지만 많은 사용자들이 이 경고를 보지만 직접 해결할 수 없는 상황
- PR 제안: 경고 로직을 수정하여 node_modules 외부에서만 경고가 표시되도록 변경, Buffer() 생성자 경고와 유사한 방식
- 의견 충돌
  - 반대 의견: punycode 제거를 위한 한 걸음 후퇴
  - 찬성 의견: 원래 PR에서 생태계 영향이 지적되었으나 무시, 현재는 해결 능력이 없는 사용자들만 당혹

### 논쟁 부분

- 해결책 제안: npm 패키지로 punycode를 추가하여 동작 override 제안
- 답변: package.json에 override를 추가해도, 그 패키지가 다른 사람의 종속성으로 사용될 때는 npm에 의해 override가 적용되지 않음

<br />

- 장기적 해결책 부재인 상황: node-fetch@2.x.x 은 여전히 많은 다운로드되는데, Node v4와의 하위 호환성을 주장하며 업데이트하지 않음

<br />

- 경고의 효과: 해당 경고가 사람들을 짜증나게 한다면, 경고가 제대로 작동하고 있는 것
- 답변: 짜증난게 맞지만, 현재 조치를 취할 수 있는 것은 아님

### 정리

- 현재 node-fetch@2.x.x의 광범위한 사용은 punycode를 제거하는 것을 어렵게 만들고 있음
- 이에 해당 경고가 사람들을 원하는 방향으로 이동시키지 못하고 있는 상황
- node_modules 내부의 deprecation 경고는 실제로 조치를 취할 수 없으며, 단지 유지보수자들에게 부담
- 해당 PR을 통해 경고 메시지를 node_modules 외부에서만 표시되도록 제한
- 직접 해결할 수 없는 일반 사용자들의 혼란을 줄이는 것을 목표

## 참고 문서

- [punycode: limit deprecation warning](https://github.com/nodejs/node/pull/56632)
